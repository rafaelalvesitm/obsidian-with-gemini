/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __commonJS = (cb, mod) => function __require() {
  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// node_modules/@google/generative-ai/dist/index.js
var require_dist = __commonJS({
  "node_modules/@google/generative-ai/dist/index.js"(exports) {
    "use strict";
    var POSSIBLE_ROLES = ["user", "model", "function", "system"];
    exports.HarmCategory = void 0;
    (function(HarmCategory) {
      HarmCategory["HARM_CATEGORY_UNSPECIFIED"] = "HARM_CATEGORY_UNSPECIFIED";
      HarmCategory["HARM_CATEGORY_HATE_SPEECH"] = "HARM_CATEGORY_HATE_SPEECH";
      HarmCategory["HARM_CATEGORY_SEXUALLY_EXPLICIT"] = "HARM_CATEGORY_SEXUALLY_EXPLICIT";
      HarmCategory["HARM_CATEGORY_HARASSMENT"] = "HARM_CATEGORY_HARASSMENT";
      HarmCategory["HARM_CATEGORY_DANGEROUS_CONTENT"] = "HARM_CATEGORY_DANGEROUS_CONTENT";
    })(exports.HarmCategory || (exports.HarmCategory = {}));
    exports.HarmBlockThreshold = void 0;
    (function(HarmBlockThreshold) {
      HarmBlockThreshold["HARM_BLOCK_THRESHOLD_UNSPECIFIED"] = "HARM_BLOCK_THRESHOLD_UNSPECIFIED";
      HarmBlockThreshold["BLOCK_LOW_AND_ABOVE"] = "BLOCK_LOW_AND_ABOVE";
      HarmBlockThreshold["BLOCK_MEDIUM_AND_ABOVE"] = "BLOCK_MEDIUM_AND_ABOVE";
      HarmBlockThreshold["BLOCK_ONLY_HIGH"] = "BLOCK_ONLY_HIGH";
      HarmBlockThreshold["BLOCK_NONE"] = "BLOCK_NONE";
    })(exports.HarmBlockThreshold || (exports.HarmBlockThreshold = {}));
    exports.HarmProbability = void 0;
    (function(HarmProbability) {
      HarmProbability["HARM_PROBABILITY_UNSPECIFIED"] = "HARM_PROBABILITY_UNSPECIFIED";
      HarmProbability["NEGLIGIBLE"] = "NEGLIGIBLE";
      HarmProbability["LOW"] = "LOW";
      HarmProbability["MEDIUM"] = "MEDIUM";
      HarmProbability["HIGH"] = "HIGH";
    })(exports.HarmProbability || (exports.HarmProbability = {}));
    exports.BlockReason = void 0;
    (function(BlockReason) {
      BlockReason["BLOCKED_REASON_UNSPECIFIED"] = "BLOCKED_REASON_UNSPECIFIED";
      BlockReason["SAFETY"] = "SAFETY";
      BlockReason["OTHER"] = "OTHER";
    })(exports.BlockReason || (exports.BlockReason = {}));
    exports.FinishReason = void 0;
    (function(FinishReason) {
      FinishReason["FINISH_REASON_UNSPECIFIED"] = "FINISH_REASON_UNSPECIFIED";
      FinishReason["STOP"] = "STOP";
      FinishReason["MAX_TOKENS"] = "MAX_TOKENS";
      FinishReason["SAFETY"] = "SAFETY";
      FinishReason["RECITATION"] = "RECITATION";
      FinishReason["OTHER"] = "OTHER";
    })(exports.FinishReason || (exports.FinishReason = {}));
    exports.TaskType = void 0;
    (function(TaskType) {
      TaskType["TASK_TYPE_UNSPECIFIED"] = "TASK_TYPE_UNSPECIFIED";
      TaskType["RETRIEVAL_QUERY"] = "RETRIEVAL_QUERY";
      TaskType["RETRIEVAL_DOCUMENT"] = "RETRIEVAL_DOCUMENT";
      TaskType["SEMANTIC_SIMILARITY"] = "SEMANTIC_SIMILARITY";
      TaskType["CLASSIFICATION"] = "CLASSIFICATION";
      TaskType["CLUSTERING"] = "CLUSTERING";
    })(exports.TaskType || (exports.TaskType = {}));
    exports.FunctionCallingMode = void 0;
    (function(FunctionCallingMode) {
      FunctionCallingMode["MODE_UNSPECIFIED"] = "MODE_UNSPECIFIED";
      FunctionCallingMode["AUTO"] = "AUTO";
      FunctionCallingMode["ANY"] = "ANY";
      FunctionCallingMode["NONE"] = "NONE";
    })(exports.FunctionCallingMode || (exports.FunctionCallingMode = {}));
    exports.FunctionDeclarationSchemaType = void 0;
    (function(FunctionDeclarationSchemaType) {
      FunctionDeclarationSchemaType["STRING"] = "STRING";
      FunctionDeclarationSchemaType["NUMBER"] = "NUMBER";
      FunctionDeclarationSchemaType["INTEGER"] = "INTEGER";
      FunctionDeclarationSchemaType["BOOLEAN"] = "BOOLEAN";
      FunctionDeclarationSchemaType["ARRAY"] = "ARRAY";
      FunctionDeclarationSchemaType["OBJECT"] = "OBJECT";
    })(exports.FunctionDeclarationSchemaType || (exports.FunctionDeclarationSchemaType = {}));
    var GoogleGenerativeAIError = class extends Error {
      constructor(message) {
        super(`[GoogleGenerativeAI Error]: ${message}`);
      }
    };
    var GoogleGenerativeAIResponseError = class extends GoogleGenerativeAIError {
      constructor(message, response) {
        super(message);
        this.response = response;
      }
    };
    var GoogleGenerativeAIFetchError = class extends GoogleGenerativeAIError {
      constructor(message, status, statusText, errorDetails) {
        super(message);
        this.status = status;
        this.statusText = statusText;
        this.errorDetails = errorDetails;
      }
    };
    var GoogleGenerativeAIRequestInputError = class extends GoogleGenerativeAIError {
    };
    var DEFAULT_BASE_URL = "https://generativelanguage.googleapis.com";
    var DEFAULT_API_VERSION = "v1beta";
    var PACKAGE_VERSION = "0.11.1";
    var PACKAGE_LOG_HEADER = "genai-js";
    var Task;
    (function(Task2) {
      Task2["GENERATE_CONTENT"] = "generateContent";
      Task2["STREAM_GENERATE_CONTENT"] = "streamGenerateContent";
      Task2["COUNT_TOKENS"] = "countTokens";
      Task2["EMBED_CONTENT"] = "embedContent";
      Task2["BATCH_EMBED_CONTENTS"] = "batchEmbedContents";
    })(Task || (Task = {}));
    var RequestUrl = class {
      constructor(model, task, apiKey, stream, requestOptions) {
        this.model = model;
        this.task = task;
        this.apiKey = apiKey;
        this.stream = stream;
        this.requestOptions = requestOptions;
      }
      toString() {
        var _a, _b;
        const apiVersion = ((_a = this.requestOptions) === null || _a === void 0 ? void 0 : _a.apiVersion) || DEFAULT_API_VERSION;
        const baseUrl = ((_b = this.requestOptions) === null || _b === void 0 ? void 0 : _b.baseUrl) || DEFAULT_BASE_URL;
        let url = `${baseUrl}/${apiVersion}/${this.model}:${this.task}`;
        if (this.stream) {
          url += "?alt=sse";
        }
        return url;
      }
    };
    function getClientHeaders(requestOptions) {
      const clientHeaders = [];
      if (requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.apiClient) {
        clientHeaders.push(requestOptions.apiClient);
      }
      clientHeaders.push(`${PACKAGE_LOG_HEADER}/${PACKAGE_VERSION}`);
      return clientHeaders.join(" ");
    }
    async function getHeaders(url) {
      const headers = new Headers();
      headers.append("Content-Type", "application/json");
      headers.append("x-goog-api-client", getClientHeaders(url.requestOptions));
      headers.append("x-goog-api-key", url.apiKey);
      let customHeaders = url.requestOptions.customHeaders;
      if (customHeaders) {
        if (!(customHeaders instanceof Headers)) {
          try {
            customHeaders = new Headers(customHeaders);
          } catch (e) {
            throw new GoogleGenerativeAIRequestInputError(`unable to convert customHeaders value ${JSON.stringify(customHeaders)} to Headers: ${e.message}`);
          }
        }
        for (const [headerName, headerValue] of customHeaders.entries()) {
          if (headerName === "x-goog-api-key") {
            throw new GoogleGenerativeAIRequestInputError(`Cannot set reserved header name ${headerName}`);
          } else if (headerName === "x-goog-api-client") {
            throw new GoogleGenerativeAIRequestInputError(`Header name ${headerName} can only be set using the apiClient field`);
          }
          headers.append(headerName, headerValue);
        }
      }
      return headers;
    }
    async function constructRequest(model, task, apiKey, stream, body, requestOptions) {
      const url = new RequestUrl(model, task, apiKey, stream, requestOptions);
      return {
        url: url.toString(),
        fetchOptions: Object.assign(Object.assign({}, buildFetchOptions(requestOptions)), { method: "POST", headers: await getHeaders(url), body })
      };
    }
    async function makeRequest(model, task, apiKey, stream, body, requestOptions) {
      return _makeRequestInternal(model, task, apiKey, stream, body, requestOptions, fetch);
    }
    async function _makeRequestInternal(model, task, apiKey, stream, body, requestOptions, fetchFn = fetch) {
      const url = new RequestUrl(model, task, apiKey, stream, requestOptions);
      let response;
      try {
        const request = await constructRequest(model, task, apiKey, stream, body, requestOptions);
        response = await fetchFn(request.url, request.fetchOptions);
        if (!response.ok) {
          let message = "";
          let errorDetails;
          try {
            const json = await response.json();
            message = json.error.message;
            if (json.error.details) {
              message += ` ${JSON.stringify(json.error.details)}`;
              errorDetails = json.error.details;
            }
          } catch (e) {
          }
          throw new GoogleGenerativeAIFetchError(`Error fetching from ${url.toString()}: [${response.status} ${response.statusText}] ${message}`, response.status, response.statusText, errorDetails);
        }
      } catch (e) {
        let err = e;
        if (!(e instanceof GoogleGenerativeAIFetchError || e instanceof GoogleGenerativeAIRequestInputError)) {
          err = new GoogleGenerativeAIError(`Error fetching from ${url.toString()}: ${e.message}`);
          err.stack = e.stack;
        }
        throw err;
      }
      return response;
    }
    function buildFetchOptions(requestOptions) {
      const fetchOptions = {};
      if ((requestOptions === null || requestOptions === void 0 ? void 0 : requestOptions.timeout) >= 0) {
        const abortController = new AbortController();
        const signal = abortController.signal;
        setTimeout(() => abortController.abort(), requestOptions.timeout);
        fetchOptions.signal = signal;
      }
      return fetchOptions;
    }
    function addHelpers(response) {
      response.text = () => {
        if (response.candidates && response.candidates.length > 0) {
          if (response.candidates.length > 1) {
            console.warn(`This response had ${response.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`);
          }
          if (hadBadFinishReason(response.candidates[0])) {
            throw new GoogleGenerativeAIResponseError(`${formatBlockErrorMessage(response)}`, response);
          }
          return getText(response);
        } else if (response.promptFeedback) {
          throw new GoogleGenerativeAIResponseError(`Text not available. ${formatBlockErrorMessage(response)}`, response);
        }
        return "";
      };
      response.functionCall = () => {
        if (response.candidates && response.candidates.length > 0) {
          if (response.candidates.length > 1) {
            console.warn(`This response had ${response.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`);
          }
          if (hadBadFinishReason(response.candidates[0])) {
            throw new GoogleGenerativeAIResponseError(`${formatBlockErrorMessage(response)}`, response);
          }
          console.warn(`response.functionCall() is deprecated. Use response.functionCalls() instead.`);
          return getFunctionCalls(response)[0];
        } else if (response.promptFeedback) {
          throw new GoogleGenerativeAIResponseError(`Function call not available. ${formatBlockErrorMessage(response)}`, response);
        }
        return void 0;
      };
      response.functionCalls = () => {
        if (response.candidates && response.candidates.length > 0) {
          if (response.candidates.length > 1) {
            console.warn(`This response had ${response.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`);
          }
          if (hadBadFinishReason(response.candidates[0])) {
            throw new GoogleGenerativeAIResponseError(`${formatBlockErrorMessage(response)}`, response);
          }
          return getFunctionCalls(response);
        } else if (response.promptFeedback) {
          throw new GoogleGenerativeAIResponseError(`Function call not available. ${formatBlockErrorMessage(response)}`, response);
        }
        return void 0;
      };
      return response;
    }
    function getText(response) {
      var _a, _b, _c, _d;
      const textStrings = [];
      if ((_b = (_a = response.candidates) === null || _a === void 0 ? void 0 : _a[0].content) === null || _b === void 0 ? void 0 : _b.parts) {
        for (const part of (_d = (_c = response.candidates) === null || _c === void 0 ? void 0 : _c[0].content) === null || _d === void 0 ? void 0 : _d.parts) {
          if (part.text) {
            textStrings.push(part.text);
          }
        }
      }
      if (textStrings.length > 0) {
        return textStrings.join("");
      } else {
        return "";
      }
    }
    function getFunctionCalls(response) {
      var _a, _b, _c, _d;
      const functionCalls = [];
      if ((_b = (_a = response.candidates) === null || _a === void 0 ? void 0 : _a[0].content) === null || _b === void 0 ? void 0 : _b.parts) {
        for (const part of (_d = (_c = response.candidates) === null || _c === void 0 ? void 0 : _c[0].content) === null || _d === void 0 ? void 0 : _d.parts) {
          if (part.functionCall) {
            functionCalls.push(part.functionCall);
          }
        }
      }
      if (functionCalls.length > 0) {
        return functionCalls;
      } else {
        return void 0;
      }
    }
    var badFinishReasons = [exports.FinishReason.RECITATION, exports.FinishReason.SAFETY];
    function hadBadFinishReason(candidate) {
      return !!candidate.finishReason && badFinishReasons.includes(candidate.finishReason);
    }
    function formatBlockErrorMessage(response) {
      var _a, _b, _c;
      let message = "";
      if ((!response.candidates || response.candidates.length === 0) && response.promptFeedback) {
        message += "Response was blocked";
        if ((_a = response.promptFeedback) === null || _a === void 0 ? void 0 : _a.blockReason) {
          message += ` due to ${response.promptFeedback.blockReason}`;
        }
        if ((_b = response.promptFeedback) === null || _b === void 0 ? void 0 : _b.blockReasonMessage) {
          message += `: ${response.promptFeedback.blockReasonMessage}`;
        }
      } else if ((_c = response.candidates) === null || _c === void 0 ? void 0 : _c[0]) {
        const firstCandidate = response.candidates[0];
        if (hadBadFinishReason(firstCandidate)) {
          message += `Candidate was blocked due to ${firstCandidate.finishReason}`;
          if (firstCandidate.finishMessage) {
            message += `: ${firstCandidate.finishMessage}`;
          }
        }
      }
      return message;
    }
    function __await(v) {
      return this instanceof __await ? (this.v = v, this) : new __await(v);
    }
    function __asyncGenerator(thisArg, _arguments, generator) {
      if (!Symbol.asyncIterator)
        throw new TypeError("Symbol.asyncIterator is not defined.");
      var g = generator.apply(thisArg, _arguments || []), i, q = [];
      return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function() {
        return this;
      }, i;
      function verb(n) {
        if (g[n])
          i[n] = function(v) {
            return new Promise(function(a, b) {
              q.push([n, v, a, b]) > 1 || resume(n, v);
            });
          };
      }
      function resume(n, v) {
        try {
          step(g[n](v));
        } catch (e) {
          settle(q[0][3], e);
        }
      }
      function step(r) {
        r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);
      }
      function fulfill(value) {
        resume("next", value);
      }
      function reject(value) {
        resume("throw", value);
      }
      function settle(f, v) {
        if (f(v), q.shift(), q.length)
          resume(q[0][0], q[0][1]);
      }
    }
    var responseLineRE = /^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;
    function processStream(response) {
      const inputStream = response.body.pipeThrough(new TextDecoderStream("utf8", { fatal: true }));
      const responseStream = getResponseStream(inputStream);
      const [stream1, stream2] = responseStream.tee();
      return {
        stream: generateResponseSequence(stream1),
        response: getResponsePromise(stream2)
      };
    }
    async function getResponsePromise(stream) {
      const allResponses = [];
      const reader = stream.getReader();
      while (true) {
        const { done, value } = await reader.read();
        if (done) {
          return addHelpers(aggregateResponses(allResponses));
        }
        allResponses.push(value);
      }
    }
    function generateResponseSequence(stream) {
      return __asyncGenerator(this, arguments, function* generateResponseSequence_1() {
        const reader = stream.getReader();
        while (true) {
          const { value, done } = yield __await(reader.read());
          if (done) {
            break;
          }
          yield yield __await(addHelpers(value));
        }
      });
    }
    function getResponseStream(inputStream) {
      const reader = inputStream.getReader();
      const stream = new ReadableStream({
        start(controller) {
          let currentText = "";
          return pump();
          function pump() {
            return reader.read().then(({ value, done }) => {
              if (done) {
                if (currentText.trim()) {
                  controller.error(new GoogleGenerativeAIError("Failed to parse stream"));
                  return;
                }
                controller.close();
                return;
              }
              currentText += value;
              let match = currentText.match(responseLineRE);
              let parsedResponse;
              while (match) {
                try {
                  parsedResponse = JSON.parse(match[1]);
                } catch (e) {
                  controller.error(new GoogleGenerativeAIError(`Error parsing JSON response: "${match[1]}"`));
                  return;
                }
                controller.enqueue(parsedResponse);
                currentText = currentText.substring(match[0].length);
                match = currentText.match(responseLineRE);
              }
              return pump();
            });
          }
        }
      });
      return stream;
    }
    function aggregateResponses(responses) {
      const lastResponse = responses[responses.length - 1];
      const aggregatedResponse = {
        promptFeedback: lastResponse === null || lastResponse === void 0 ? void 0 : lastResponse.promptFeedback
      };
      for (const response of responses) {
        if (response.candidates) {
          for (const candidate of response.candidates) {
            const i = candidate.index;
            if (!aggregatedResponse.candidates) {
              aggregatedResponse.candidates = [];
            }
            if (!aggregatedResponse.candidates[i]) {
              aggregatedResponse.candidates[i] = {
                index: candidate.index
              };
            }
            aggregatedResponse.candidates[i].citationMetadata = candidate.citationMetadata;
            aggregatedResponse.candidates[i].finishReason = candidate.finishReason;
            aggregatedResponse.candidates[i].finishMessage = candidate.finishMessage;
            aggregatedResponse.candidates[i].safetyRatings = candidate.safetyRatings;
            if (candidate.content && candidate.content.parts) {
              if (!aggregatedResponse.candidates[i].content) {
                aggregatedResponse.candidates[i].content = {
                  role: candidate.content.role || "user",
                  parts: []
                };
              }
              const newPart = {};
              for (const part of candidate.content.parts) {
                if (part.text) {
                  newPart.text = part.text;
                }
                if (part.functionCall) {
                  newPart.functionCall = part.functionCall;
                }
                if (Object.keys(newPart).length === 0) {
                  newPart.text = "";
                }
                aggregatedResponse.candidates[i].content.parts.push(newPart);
              }
            }
          }
        }
      }
      return aggregatedResponse;
    }
    async function generateContentStream(apiKey, model, params, requestOptions) {
      const response = await makeRequest(
        model,
        Task.STREAM_GENERATE_CONTENT,
        apiKey,
        /* stream */
        true,
        JSON.stringify(params),
        requestOptions
      );
      return processStream(response);
    }
    async function generateContent(apiKey, model, params, requestOptions) {
      const response = await makeRequest(
        model,
        Task.GENERATE_CONTENT,
        apiKey,
        /* stream */
        false,
        JSON.stringify(params),
        requestOptions
      );
      const responseJson = await response.json();
      const enhancedResponse = addHelpers(responseJson);
      return {
        response: enhancedResponse
      };
    }
    function formatSystemInstruction(input) {
      if (input == null) {
        return void 0;
      } else if (typeof input === "string") {
        return { role: "system", parts: [{ text: input }] };
      } else if (input.text) {
        return { role: "system", parts: [input] };
      } else if (input.parts) {
        if (!input.role) {
          return { role: "system", parts: input.parts };
        } else {
          return input;
        }
      }
    }
    function formatNewContent(request) {
      let newParts = [];
      if (typeof request === "string") {
        newParts = [{ text: request }];
      } else {
        for (const partOrString of request) {
          if (typeof partOrString === "string") {
            newParts.push({ text: partOrString });
          } else {
            newParts.push(partOrString);
          }
        }
      }
      return assignRoleToPartsAndValidateSendMessageRequest(newParts);
    }
    function assignRoleToPartsAndValidateSendMessageRequest(parts) {
      const userContent = { role: "user", parts: [] };
      const functionContent = { role: "function", parts: [] };
      let hasUserContent = false;
      let hasFunctionContent = false;
      for (const part of parts) {
        if ("functionResponse" in part) {
          functionContent.parts.push(part);
          hasFunctionContent = true;
        } else {
          userContent.parts.push(part);
          hasUserContent = true;
        }
      }
      if (hasUserContent && hasFunctionContent) {
        throw new GoogleGenerativeAIError("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");
      }
      if (!hasUserContent && !hasFunctionContent) {
        throw new GoogleGenerativeAIError("No content is provided for sending chat message.");
      }
      if (hasUserContent) {
        return userContent;
      }
      return functionContent;
    }
    function formatGenerateContentInput(params) {
      let formattedRequest;
      if (params.contents) {
        formattedRequest = params;
      } else {
        const content = formatNewContent(params);
        formattedRequest = { contents: [content] };
      }
      if (params.systemInstruction) {
        formattedRequest.systemInstruction = formatSystemInstruction(params.systemInstruction);
      }
      return formattedRequest;
    }
    function formatEmbedContentInput(params) {
      if (typeof params === "string" || Array.isArray(params)) {
        const content = formatNewContent(params);
        return { content };
      }
      return params;
    }
    var VALID_PART_FIELDS = [
      "text",
      "inlineData",
      "functionCall",
      "functionResponse"
    ];
    var VALID_PARTS_PER_ROLE = {
      user: ["text", "inlineData"],
      function: ["functionResponse"],
      model: ["text", "functionCall"],
      // System instructions shouldn't be in history anyway.
      system: ["text"]
    };
    var VALID_PREVIOUS_CONTENT_ROLES = {
      user: ["model"],
      function: ["model"],
      model: ["user", "function"],
      // System instructions shouldn't be in history.
      system: []
    };
    function validateChatHistory(history) {
      let prevContent;
      for (const currContent of history) {
        const { role, parts } = currContent;
        if (!prevContent && role !== "user") {
          throw new GoogleGenerativeAIError(`First content should be with role 'user', got ${role}`);
        }
        if (!POSSIBLE_ROLES.includes(role)) {
          throw new GoogleGenerativeAIError(`Each item should include role field. Got ${role} but valid roles are: ${JSON.stringify(POSSIBLE_ROLES)}`);
        }
        if (!Array.isArray(parts)) {
          throw new GoogleGenerativeAIError("Content should have 'parts' property with an array of Parts");
        }
        if (parts.length === 0) {
          throw new GoogleGenerativeAIError("Each Content should have at least one part");
        }
        const countFields = {
          text: 0,
          inlineData: 0,
          functionCall: 0,
          functionResponse: 0,
          fileData: 0
        };
        for (const part of parts) {
          for (const key of VALID_PART_FIELDS) {
            if (key in part) {
              countFields[key] += 1;
            }
          }
        }
        const validParts = VALID_PARTS_PER_ROLE[role];
        for (const key of VALID_PART_FIELDS) {
          if (!validParts.includes(key) && countFields[key] > 0) {
            throw new GoogleGenerativeAIError(`Content with role '${role}' can't contain '${key}' part`);
          }
        }
        if (prevContent) {
          const validPreviousContentRoles = VALID_PREVIOUS_CONTENT_ROLES[role];
          if (!validPreviousContentRoles.includes(prevContent.role)) {
            throw new GoogleGenerativeAIError(`Content with role '${role}' can't follow '${prevContent.role}'. Valid previous roles: ${JSON.stringify(VALID_PREVIOUS_CONTENT_ROLES)}`);
          }
        }
        prevContent = currContent;
      }
    }
    var SILENT_ERROR = "SILENT_ERROR";
    var ChatSession = class {
      constructor(apiKey, model, params, requestOptions) {
        this.model = model;
        this.params = params;
        this.requestOptions = requestOptions;
        this._history = [];
        this._sendPromise = Promise.resolve();
        this._apiKey = apiKey;
        if (params === null || params === void 0 ? void 0 : params.history) {
          validateChatHistory(params.history);
          this._history = params.history;
        }
      }
      /**
       * Gets the chat history so far. Blocked prompts are not added to history.
       * Blocked candidates are not added to history, nor are the prompts that
       * generated them.
       */
      async getHistory() {
        await this._sendPromise;
        return this._history;
      }
      /**
       * Sends a chat message and receives a non-streaming
       * {@link GenerateContentResult}
       */
      async sendMessage(request) {
        var _a, _b, _c, _d, _e;
        await this._sendPromise;
        const newContent = formatNewContent(request);
        const generateContentRequest = {
          safetySettings: (_a = this.params) === null || _a === void 0 ? void 0 : _a.safetySettings,
          generationConfig: (_b = this.params) === null || _b === void 0 ? void 0 : _b.generationConfig,
          tools: (_c = this.params) === null || _c === void 0 ? void 0 : _c.tools,
          toolConfig: (_d = this.params) === null || _d === void 0 ? void 0 : _d.toolConfig,
          systemInstruction: (_e = this.params) === null || _e === void 0 ? void 0 : _e.systemInstruction,
          contents: [...this._history, newContent]
        };
        let finalResult;
        this._sendPromise = this._sendPromise.then(() => generateContent(this._apiKey, this.model, generateContentRequest, this.requestOptions)).then((result) => {
          var _a2;
          if (result.response.candidates && result.response.candidates.length > 0) {
            this._history.push(newContent);
            const responseContent = Object.assign({
              parts: [],
              // Response seems to come back without a role set.
              role: "model"
            }, (_a2 = result.response.candidates) === null || _a2 === void 0 ? void 0 : _a2[0].content);
            this._history.push(responseContent);
          } else {
            const blockErrorMessage = formatBlockErrorMessage(result.response);
            if (blockErrorMessage) {
              console.warn(`sendMessage() was unsuccessful. ${blockErrorMessage}. Inspect response object for details.`);
            }
          }
          finalResult = result;
        });
        await this._sendPromise;
        return finalResult;
      }
      /**
       * Sends a chat message and receives the response as a
       * {@link GenerateContentStreamResult} containing an iterable stream
       * and a response promise.
       */
      async sendMessageStream(request) {
        var _a, _b, _c, _d, _e;
        await this._sendPromise;
        const newContent = formatNewContent(request);
        const generateContentRequest = {
          safetySettings: (_a = this.params) === null || _a === void 0 ? void 0 : _a.safetySettings,
          generationConfig: (_b = this.params) === null || _b === void 0 ? void 0 : _b.generationConfig,
          tools: (_c = this.params) === null || _c === void 0 ? void 0 : _c.tools,
          toolConfig: (_d = this.params) === null || _d === void 0 ? void 0 : _d.toolConfig,
          systemInstruction: (_e = this.params) === null || _e === void 0 ? void 0 : _e.systemInstruction,
          contents: [...this._history, newContent]
        };
        const streamPromise = generateContentStream(this._apiKey, this.model, generateContentRequest, this.requestOptions);
        this._sendPromise = this._sendPromise.then(() => streamPromise).catch((_ignored) => {
          throw new Error(SILENT_ERROR);
        }).then((streamResult) => streamResult.response).then((response) => {
          if (response.candidates && response.candidates.length > 0) {
            this._history.push(newContent);
            const responseContent = Object.assign({}, response.candidates[0].content);
            if (!responseContent.role) {
              responseContent.role = "model";
            }
            this._history.push(responseContent);
          } else {
            const blockErrorMessage = formatBlockErrorMessage(response);
            if (blockErrorMessage) {
              console.warn(`sendMessageStream() was unsuccessful. ${blockErrorMessage}. Inspect response object for details.`);
            }
          }
        }).catch((e) => {
          if (e.message !== SILENT_ERROR) {
            console.error(e);
          }
        });
        return streamPromise;
      }
    };
    async function countTokens(apiKey, model, params, requestOptions) {
      const response = await makeRequest(model, Task.COUNT_TOKENS, apiKey, false, JSON.stringify(Object.assign(Object.assign({}, params), { model })), requestOptions);
      return response.json();
    }
    async function embedContent(apiKey, model, params, requestOptions) {
      const response = await makeRequest(model, Task.EMBED_CONTENT, apiKey, false, JSON.stringify(params), requestOptions);
      return response.json();
    }
    async function batchEmbedContents(apiKey, model, params, requestOptions) {
      const requestsWithModel = params.requests.map((request) => {
        return Object.assign(Object.assign({}, request), { model });
      });
      const response = await makeRequest(model, Task.BATCH_EMBED_CONTENTS, apiKey, false, JSON.stringify({ requests: requestsWithModel }), requestOptions);
      return response.json();
    }
    var GenerativeModel = class {
      constructor(apiKey, modelParams, requestOptions) {
        this.apiKey = apiKey;
        if (modelParams.model.includes("/")) {
          this.model = modelParams.model;
        } else {
          this.model = `models/${modelParams.model}`;
        }
        this.generationConfig = modelParams.generationConfig || {};
        this.safetySettings = modelParams.safetySettings || [];
        this.tools = modelParams.tools;
        this.toolConfig = modelParams.toolConfig;
        this.systemInstruction = formatSystemInstruction(modelParams.systemInstruction);
        this.requestOptions = requestOptions || {};
      }
      /**
       * Makes a single non-streaming call to the model
       * and returns an object containing a single {@link GenerateContentResponse}.
       */
      async generateContent(request) {
        const formattedParams = formatGenerateContentInput(request);
        return generateContent(this.apiKey, this.model, Object.assign({ generationConfig: this.generationConfig, safetySettings: this.safetySettings, tools: this.tools, toolConfig: this.toolConfig, systemInstruction: this.systemInstruction }, formattedParams), this.requestOptions);
      }
      /**
       * Makes a single streaming call to the model
       * and returns an object containing an iterable stream that iterates
       * over all chunks in the streaming response as well as
       * a promise that returns the final aggregated response.
       */
      async generateContentStream(request) {
        const formattedParams = formatGenerateContentInput(request);
        return generateContentStream(this.apiKey, this.model, Object.assign({ generationConfig: this.generationConfig, safetySettings: this.safetySettings, tools: this.tools, toolConfig: this.toolConfig, systemInstruction: this.systemInstruction }, formattedParams), this.requestOptions);
      }
      /**
       * Gets a new {@link ChatSession} instance which can be used for
       * multi-turn chats.
       */
      startChat(startChatParams) {
        return new ChatSession(this.apiKey, this.model, Object.assign({ generationConfig: this.generationConfig, safetySettings: this.safetySettings, tools: this.tools, toolConfig: this.toolConfig, systemInstruction: this.systemInstruction }, startChatParams), this.requestOptions);
      }
      /**
       * Counts the tokens in the provided request.
       */
      async countTokens(request) {
        const formattedParams = formatGenerateContentInput(request);
        return countTokens(this.apiKey, this.model, formattedParams, this.requestOptions);
      }
      /**
       * Embeds the provided content.
       */
      async embedContent(request) {
        const formattedParams = formatEmbedContentInput(request);
        return embedContent(this.apiKey, this.model, formattedParams, this.requestOptions);
      }
      /**
       * Embeds an array of {@link EmbedContentRequest}s.
       */
      async batchEmbedContents(batchEmbedContentRequest) {
        return batchEmbedContents(this.apiKey, this.model, batchEmbedContentRequest, this.requestOptions);
      }
    };
    var GoogleGenerativeAI2 = class {
      constructor(apiKey) {
        this.apiKey = apiKey;
      }
      /**
       * Gets a {@link GenerativeModel} instance for the provided model name.
       */
      getGenerativeModel(modelParams, requestOptions) {
        if (!modelParams.model) {
          throw new GoogleGenerativeAIError(`Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })`);
        }
        return new GenerativeModel(this.apiKey, modelParams, requestOptions);
      }
    };
    exports.ChatSession = ChatSession;
    exports.GenerativeModel = GenerativeModel;
    exports.GoogleGenerativeAI = GoogleGenerativeAI2;
    exports.GoogleGenerativeAIError = GoogleGenerativeAIError;
    exports.GoogleGenerativeAIFetchError = GoogleGenerativeAIFetchError;
    exports.GoogleGenerativeAIRequestInputError = GoogleGenerativeAIRequestInputError;
    exports.GoogleGenerativeAIResponseError = GoogleGenerativeAIResponseError;
    exports.POSSIBLE_ROLES = POSSIBLE_ROLES;
  }
});

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => GeminiPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var { GoogleGenerativeAI } = require_dist();
var DEFAULT_SETTINGS = {
  APIKey: "",
  promptSummary: "Resuma o texto a seguir: ",
  promptExpand: "Expanda o texto a seguir: ",
  promptRewrite: "Reescreva o texto a seguir: ",
  promptAnswer: "Responda a pergunta a seguir:"
};
var GeminiPlugin = class extends import_obsidian.Plugin {
  // Instância do Google Generative AI
  // Função de inicialização do plugin
  async onload() {
    await this.loadSettings();
    this.genAI = new GoogleGenerativeAI(this.settings.APIKey);
    this.addCommand({
      id: "quick-summary",
      name: "Resumir texto",
      editorCallback: async (editor, view) => {
        const selection = editor.getSelection();
        const loadingModal = new LoadingModal(this.app);
        loadingModal.open();
        try {
          const prompt = this.settings.promptSummary + selection;
          const result = await run(prompt, this.genAI);
          const cursor = editor.getCursor();
          editor.replaceRange("\n\n" + result, { line: cursor.line + 1, ch: 0 }, { line: cursor.line + 1, ch: 0 });
          editor.setCursor({ line: cursor.line + 2, ch: 0 });
        } catch (error) {
          new import_obsidian.Notice("Erro ao gerar conte\xFAdo: " + error.message);
        } finally {
          loadingModal.close();
        }
      }
    });
    this.addCommand({
      id: "quick-expand",
      name: "Expandir texto",
      editorCallback: async (editor, view) => {
        const selection = editor.getSelection();
        const loadingModal = new LoadingModal(this.app);
        loadingModal.open();
        try {
          const prompt = this.settings.promptExpand + selection;
          const result = await run(prompt, this.genAI);
          const cursor = editor.getCursor();
          editor.replaceRange("\n\n" + result, { line: cursor.line + 1, ch: 0 }, { line: cursor.line + 1, ch: 0 });
          editor.setCursor({ line: cursor.line + 2, ch: 0 });
        } catch (error) {
          new import_obsidian.Notice("Erro ao gerar conte\xFAdo: " + error.message);
        } finally {
          loadingModal.close();
        }
      }
    });
    this.addCommand({
      id: "quick-rewrite",
      name: "Reescrever texto",
      editorCallback: async (editor, view) => {
        const selection = editor.getSelection();
        const loadingModal = new LoadingModal(this.app);
        loadingModal.open();
        try {
          const prompt = this.settings.promptRewrite + selection;
          const result = await run(prompt, this.genAI);
          const cursor = editor.getCursor();
          editor.replaceRange("\n\n" + result, { line: cursor.line + 1, ch: 0 }, { line: cursor.line + 1, ch: 0 });
          editor.setCursor({ line: cursor.line + 2, ch: 0 });
        } catch (error) {
          new import_obsidian.Notice("Erro ao gerar conte\xFAdo: " + error.message);
        } finally {
          loadingModal.close();
        }
      }
    });
    this.addCommand({
      id: "quick-answer",
      name: "Responder texto",
      editorCallback: async (editor, view) => {
        const selection = editor.getSelection();
        const loadingModal = new LoadingModal(this.app);
        loadingModal.open();
        try {
          const prompt = this.settings.promptAnswer + selection;
          const result = await run(prompt, this.genAI);
          const cursor = editor.getCursor();
          editor.replaceRange("\n\n" + result, { line: cursor.line + 1, ch: 0 }, { line: cursor.line + 1, ch: 0 });
          editor.setCursor({ line: cursor.line + 2, ch: 0 });
        } catch (error) {
          new import_obsidian.Notice("Erro ao gerar conte\xFAdo: " + error.message);
        } finally {
          loadingModal.close();
        }
      }
    });
    this.addSettingTab(new SampleSettingTab(this.app, this));
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var SampleSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("API Key").setDesc("Pegue a sua chave de acesso no site do Gemini AI (https://makersuite.google.com/app/apikey?hl=pt-br).").addText((text) => text.setPlaceholder("Sua API KEY").setValue(this.plugin.settings.APIKey).onChange(async (value) => {
      this.plugin.settings.APIKey = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Prompt para resumos").setDesc('Defina qual base de prompt ser\xE1 utilizada para resumos. Exemplo: "Resuma o texto a seguir"').addText((text) => text.setPlaceholder("Resumo o texto a seguir: ").setValue(this.plugin.settings.promptSummary).onChange(async (value) => {
      this.plugin.settings.promptSummary = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Prompt para expandir").setDesc('Defina qual base de prompt ser\xE1 utilizada para expandir. Exemplo: "Expanda o texto a seguir:"').addText((text) => text.setPlaceholder("Expanda o texto a seguir: ").setValue(this.plugin.settings.promptExpand).onChange(async (value) => {
      this.plugin.settings.promptExpand = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Prompt para reescrever").setDesc('Defina qual base de prompt ser\xE1 utilizada para reescrever. Exemplo: "Reescreva o texto a seguir:"').addText((text) => text.setPlaceholder("Reescreva o texto a seguir: ").setValue(this.plugin.settings.promptRewrite).onChange(async (value) => {
      this.plugin.settings.promptRewrite = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Prompt para responder").setDesc('Defina qual base de prompt ser\xE1 utilizada para responder. Exemplo: "Responda a pergunta a seguir:"').addText((text) => text.setPlaceholder("Responda a pergunta a seguir: ").setValue(this.plugin.settings.promptAnswer).onChange(async (value) => {
      this.plugin.settings.promptAnswer = value;
      await this.plugin.saveSettings();
    }));
  }
};
async function run(prompt, genAI) {
  const model = genAI.getGenerativeModel({ model: "gemini-pro" });
  const result = await model.generateContent(prompt);
  const response = await result.response;
  const text = response.text();
  return text;
}
var LoadingModal = class extends import_obsidian.Modal {
  constructor(app) {
    super(app);
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.createEl("div", { text: "Generating content...", cls: "loading-message" });
    contentEl.createEl("div", { cls: "loading-animation" });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
/*! Bundled license information:

@google/generative-ai/dist/index.js:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibm9kZV9tb2R1bGVzL0Bnb29nbGUvZ2VuZXJhdGl2ZS1haS9kaXN0L2luZGV4LmpzIiwgIm1haW4udHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjQgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUG9zc2libGUgcm9sZXMuXG4gKiBAcHVibGljXG4gKi9cbmNvbnN0IFBPU1NJQkxFX1JPTEVTID0gW1widXNlclwiLCBcIm1vZGVsXCIsIFwiZnVuY3Rpb25cIiwgXCJzeXN0ZW1cIl07XG4vKipcbiAqIEhhcm0gY2F0ZWdvcmllcyB0aGF0IHdvdWxkIGNhdXNlIHByb21wdHMgb3IgY2FuZGlkYXRlcyB0byBiZSBibG9ja2VkLlxuICogQHB1YmxpY1xuICovXG5leHBvcnRzLkhhcm1DYXRlZ29yeSA9IHZvaWQgMDtcbihmdW5jdGlvbiAoSGFybUNhdGVnb3J5KSB7XG4gICAgSGFybUNhdGVnb3J5W1wiSEFSTV9DQVRFR09SWV9VTlNQRUNJRklFRFwiXSA9IFwiSEFSTV9DQVRFR09SWV9VTlNQRUNJRklFRFwiO1xuICAgIEhhcm1DYXRlZ29yeVtcIkhBUk1fQ0FURUdPUllfSEFURV9TUEVFQ0hcIl0gPSBcIkhBUk1fQ0FURUdPUllfSEFURV9TUEVFQ0hcIjtcbiAgICBIYXJtQ2F0ZWdvcnlbXCJIQVJNX0NBVEVHT1JZX1NFWFVBTExZX0VYUExJQ0lUXCJdID0gXCJIQVJNX0NBVEVHT1JZX1NFWFVBTExZX0VYUExJQ0lUXCI7XG4gICAgSGFybUNhdGVnb3J5W1wiSEFSTV9DQVRFR09SWV9IQVJBU1NNRU5UXCJdID0gXCJIQVJNX0NBVEVHT1JZX0hBUkFTU01FTlRcIjtcbiAgICBIYXJtQ2F0ZWdvcnlbXCJIQVJNX0NBVEVHT1JZX0RBTkdFUk9VU19DT05URU5UXCJdID0gXCJIQVJNX0NBVEVHT1JZX0RBTkdFUk9VU19DT05URU5UXCI7XG59KShleHBvcnRzLkhhcm1DYXRlZ29yeSB8fCAoZXhwb3J0cy5IYXJtQ2F0ZWdvcnkgPSB7fSkpO1xuLyoqXG4gKiBUaHJlc2hvbGQgYWJvdmUgd2hpY2ggYSBwcm9tcHQgb3IgY2FuZGlkYXRlIHdpbGwgYmUgYmxvY2tlZC5cbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0cy5IYXJtQmxvY2tUaHJlc2hvbGQgPSB2b2lkIDA7XG4oZnVuY3Rpb24gKEhhcm1CbG9ja1RocmVzaG9sZCkge1xuICAgIC8vIFRocmVzaG9sZCBpcyB1bnNwZWNpZmllZC5cbiAgICBIYXJtQmxvY2tUaHJlc2hvbGRbXCJIQVJNX0JMT0NLX1RIUkVTSE9MRF9VTlNQRUNJRklFRFwiXSA9IFwiSEFSTV9CTE9DS19USFJFU0hPTERfVU5TUEVDSUZJRURcIjtcbiAgICAvLyBDb250ZW50IHdpdGggTkVHTElHSUJMRSB3aWxsIGJlIGFsbG93ZWQuXG4gICAgSGFybUJsb2NrVGhyZXNob2xkW1wiQkxPQ0tfTE9XX0FORF9BQk9WRVwiXSA9IFwiQkxPQ0tfTE9XX0FORF9BQk9WRVwiO1xuICAgIC8vIENvbnRlbnQgd2l0aCBORUdMSUdJQkxFIGFuZCBMT1cgd2lsbCBiZSBhbGxvd2VkLlxuICAgIEhhcm1CbG9ja1RocmVzaG9sZFtcIkJMT0NLX01FRElVTV9BTkRfQUJPVkVcIl0gPSBcIkJMT0NLX01FRElVTV9BTkRfQUJPVkVcIjtcbiAgICAvLyBDb250ZW50IHdpdGggTkVHTElHSUJMRSwgTE9XLCBhbmQgTUVESVVNIHdpbGwgYmUgYWxsb3dlZC5cbiAgICBIYXJtQmxvY2tUaHJlc2hvbGRbXCJCTE9DS19PTkxZX0hJR0hcIl0gPSBcIkJMT0NLX09OTFlfSElHSFwiO1xuICAgIC8vIEFsbCBjb250ZW50IHdpbGwgYmUgYWxsb3dlZC5cbiAgICBIYXJtQmxvY2tUaHJlc2hvbGRbXCJCTE9DS19OT05FXCJdID0gXCJCTE9DS19OT05FXCI7XG59KShleHBvcnRzLkhhcm1CbG9ja1RocmVzaG9sZCB8fCAoZXhwb3J0cy5IYXJtQmxvY2tUaHJlc2hvbGQgPSB7fSkpO1xuLyoqXG4gKiBQcm9iYWJpbGl0eSB0aGF0IGEgcHJvbXB0IG9yIGNhbmRpZGF0ZSBtYXRjaGVzIGEgaGFybSBjYXRlZ29yeS5cbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0cy5IYXJtUHJvYmFiaWxpdHkgPSB2b2lkIDA7XG4oZnVuY3Rpb24gKEhhcm1Qcm9iYWJpbGl0eSkge1xuICAgIC8vIFByb2JhYmlsaXR5IGlzIHVuc3BlY2lmaWVkLlxuICAgIEhhcm1Qcm9iYWJpbGl0eVtcIkhBUk1fUFJPQkFCSUxJVFlfVU5TUEVDSUZJRURcIl0gPSBcIkhBUk1fUFJPQkFCSUxJVFlfVU5TUEVDSUZJRURcIjtcbiAgICAvLyBDb250ZW50IGhhcyBhIG5lZ2xpZ2libGUgY2hhbmNlIG9mIGJlaW5nIHVuc2FmZS5cbiAgICBIYXJtUHJvYmFiaWxpdHlbXCJORUdMSUdJQkxFXCJdID0gXCJORUdMSUdJQkxFXCI7XG4gICAgLy8gQ29udGVudCBoYXMgYSBsb3cgY2hhbmNlIG9mIGJlaW5nIHVuc2FmZS5cbiAgICBIYXJtUHJvYmFiaWxpdHlbXCJMT1dcIl0gPSBcIkxPV1wiO1xuICAgIC8vIENvbnRlbnQgaGFzIGEgbWVkaXVtIGNoYW5jZSBvZiBiZWluZyB1bnNhZmUuXG4gICAgSGFybVByb2JhYmlsaXR5W1wiTUVESVVNXCJdID0gXCJNRURJVU1cIjtcbiAgICAvLyBDb250ZW50IGhhcyBhIGhpZ2ggY2hhbmNlIG9mIGJlaW5nIHVuc2FmZS5cbiAgICBIYXJtUHJvYmFiaWxpdHlbXCJISUdIXCJdID0gXCJISUdIXCI7XG59KShleHBvcnRzLkhhcm1Qcm9iYWJpbGl0eSB8fCAoZXhwb3J0cy5IYXJtUHJvYmFiaWxpdHkgPSB7fSkpO1xuLyoqXG4gKiBSZWFzb24gdGhhdCBhIHByb21wdCB3YXMgYmxvY2tlZC5cbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0cy5CbG9ja1JlYXNvbiA9IHZvaWQgMDtcbihmdW5jdGlvbiAoQmxvY2tSZWFzb24pIHtcbiAgICAvLyBBIGJsb2NrZWQgcmVhc29uIHdhcyBub3Qgc3BlY2lmaWVkLlxuICAgIEJsb2NrUmVhc29uW1wiQkxPQ0tFRF9SRUFTT05fVU5TUEVDSUZJRURcIl0gPSBcIkJMT0NLRURfUkVBU09OX1VOU1BFQ0lGSUVEXCI7XG4gICAgLy8gQ29udGVudCB3YXMgYmxvY2tlZCBieSBzYWZldHkgc2V0dGluZ3MuXG4gICAgQmxvY2tSZWFzb25bXCJTQUZFVFlcIl0gPSBcIlNBRkVUWVwiO1xuICAgIC8vIENvbnRlbnQgd2FzIGJsb2NrZWQsIGJ1dCB0aGUgcmVhc29uIGlzIHVuY2F0ZWdvcml6ZWQuXG4gICAgQmxvY2tSZWFzb25bXCJPVEhFUlwiXSA9IFwiT1RIRVJcIjtcbn0pKGV4cG9ydHMuQmxvY2tSZWFzb24gfHwgKGV4cG9ydHMuQmxvY2tSZWFzb24gPSB7fSkpO1xuLyoqXG4gKiBSZWFzb24gdGhhdCBhIGNhbmRpZGF0ZSBmaW5pc2hlZC5cbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0cy5GaW5pc2hSZWFzb24gPSB2b2lkIDA7XG4oZnVuY3Rpb24gKEZpbmlzaFJlYXNvbikge1xuICAgIC8vIERlZmF1bHQgdmFsdWUuIFRoaXMgdmFsdWUgaXMgdW51c2VkLlxuICAgIEZpbmlzaFJlYXNvbltcIkZJTklTSF9SRUFTT05fVU5TUEVDSUZJRURcIl0gPSBcIkZJTklTSF9SRUFTT05fVU5TUEVDSUZJRURcIjtcbiAgICAvLyBOYXR1cmFsIHN0b3AgcG9pbnQgb2YgdGhlIG1vZGVsIG9yIHByb3ZpZGVkIHN0b3Agc2VxdWVuY2UuXG4gICAgRmluaXNoUmVhc29uW1wiU1RPUFwiXSA9IFwiU1RPUFwiO1xuICAgIC8vIFRoZSBtYXhpbXVtIG51bWJlciBvZiB0b2tlbnMgYXMgc3BlY2lmaWVkIGluIHRoZSByZXF1ZXN0IHdhcyByZWFjaGVkLlxuICAgIEZpbmlzaFJlYXNvbltcIk1BWF9UT0tFTlNcIl0gPSBcIk1BWF9UT0tFTlNcIjtcbiAgICAvLyBUaGUgY2FuZGlkYXRlIGNvbnRlbnQgd2FzIGZsYWdnZWQgZm9yIHNhZmV0eSByZWFzb25zLlxuICAgIEZpbmlzaFJlYXNvbltcIlNBRkVUWVwiXSA9IFwiU0FGRVRZXCI7XG4gICAgLy8gVGhlIGNhbmRpZGF0ZSBjb250ZW50IHdhcyBmbGFnZ2VkIGZvciByZWNpdGF0aW9uIHJlYXNvbnMuXG4gICAgRmluaXNoUmVhc29uW1wiUkVDSVRBVElPTlwiXSA9IFwiUkVDSVRBVElPTlwiO1xuICAgIC8vIFVua25vd24gcmVhc29uLlxuICAgIEZpbmlzaFJlYXNvbltcIk9USEVSXCJdID0gXCJPVEhFUlwiO1xufSkoZXhwb3J0cy5GaW5pc2hSZWFzb24gfHwgKGV4cG9ydHMuRmluaXNoUmVhc29uID0ge30pKTtcbi8qKlxuICogVGFzayB0eXBlIGZvciBlbWJlZGRpbmcgY29udGVudC5cbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0cy5UYXNrVHlwZSA9IHZvaWQgMDtcbihmdW5jdGlvbiAoVGFza1R5cGUpIHtcbiAgICBUYXNrVHlwZVtcIlRBU0tfVFlQRV9VTlNQRUNJRklFRFwiXSA9IFwiVEFTS19UWVBFX1VOU1BFQ0lGSUVEXCI7XG4gICAgVGFza1R5cGVbXCJSRVRSSUVWQUxfUVVFUllcIl0gPSBcIlJFVFJJRVZBTF9RVUVSWVwiO1xuICAgIFRhc2tUeXBlW1wiUkVUUklFVkFMX0RPQ1VNRU5UXCJdID0gXCJSRVRSSUVWQUxfRE9DVU1FTlRcIjtcbiAgICBUYXNrVHlwZVtcIlNFTUFOVElDX1NJTUlMQVJJVFlcIl0gPSBcIlNFTUFOVElDX1NJTUlMQVJJVFlcIjtcbiAgICBUYXNrVHlwZVtcIkNMQVNTSUZJQ0FUSU9OXCJdID0gXCJDTEFTU0lGSUNBVElPTlwiO1xuICAgIFRhc2tUeXBlW1wiQ0xVU1RFUklOR1wiXSA9IFwiQ0xVU1RFUklOR1wiO1xufSkoZXhwb3J0cy5UYXNrVHlwZSB8fCAoZXhwb3J0cy5UYXNrVHlwZSA9IHt9KSk7XG4vKipcbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0cy5GdW5jdGlvbkNhbGxpbmdNb2RlID0gdm9pZCAwO1xuKGZ1bmN0aW9uIChGdW5jdGlvbkNhbGxpbmdNb2RlKSB7XG4gICAgLy8gVW5zcGVjaWZpZWQgZnVuY3Rpb24gY2FsbGluZyBtb2RlLiBUaGlzIHZhbHVlIHNob3VsZCBub3QgYmUgdXNlZC5cbiAgICBGdW5jdGlvbkNhbGxpbmdNb2RlW1wiTU9ERV9VTlNQRUNJRklFRFwiXSA9IFwiTU9ERV9VTlNQRUNJRklFRFwiO1xuICAgIC8vIERlZmF1bHQgbW9kZWwgYmVoYXZpb3IsIG1vZGVsIGRlY2lkZXMgdG8gcHJlZGljdCBlaXRoZXIgYSBmdW5jdGlvbiBjYWxsXG4gICAgLy8gb3IgYSBuYXR1cmFsIGxhbmd1YWdlIHJlcHNwb3NlLlxuICAgIEZ1bmN0aW9uQ2FsbGluZ01vZGVbXCJBVVRPXCJdID0gXCJBVVRPXCI7XG4gICAgLy8gTW9kZWwgaXMgY29uc3RyYWluZWQgdG8gYWx3YXlzIHByZWRpY3RpbmcgYSBmdW5jdGlvbiBjYWxsIG9ubHkuXG4gICAgLy8gSWYgXCJhbGxvd2VkX2Z1bmN0aW9uX25hbWVzXCIgYXJlIHNldCwgdGhlIHByZWRpY3RlZCBmdW5jdGlvbiBjYWxsIHdpbGwgYmVcbiAgICAvLyBsaW1pdGVkIHRvIGFueSBvbmUgb2YgXCJhbGxvd2VkX2Z1bmN0aW9uX25hbWVzXCIsIGVsc2UgdGhlIHByZWRpY3RlZFxuICAgIC8vIGZ1bmN0aW9uIGNhbGwgd2lsbCBiZSBhbnkgb25lIG9mIHRoZSBwcm92aWRlZCBcImZ1bmN0aW9uX2RlY2xhcmF0aW9uc1wiLlxuICAgIEZ1bmN0aW9uQ2FsbGluZ01vZGVbXCJBTllcIl0gPSBcIkFOWVwiO1xuICAgIC8vIE1vZGVsIHdpbGwgbm90IHByZWRpY3QgYW55IGZ1bmN0aW9uIGNhbGwuIE1vZGVsIGJlaGF2aW9yIGlzIHNhbWUgYXMgd2hlblxuICAgIC8vIG5vdCBwYXNzaW5nIGFueSBmdW5jdGlvbiBkZWNsYXJhdGlvbnMuXG4gICAgRnVuY3Rpb25DYWxsaW5nTW9kZVtcIk5PTkVcIl0gPSBcIk5PTkVcIjtcbn0pKGV4cG9ydHMuRnVuY3Rpb25DYWxsaW5nTW9kZSB8fCAoZXhwb3J0cy5GdW5jdGlvbkNhbGxpbmdNb2RlID0ge30pKTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjQgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQ29udGFpbnMgdGhlIGxpc3Qgb2YgT3BlbkFQSSBkYXRhIHR5cGVzXG4gKiBhcyBkZWZpbmVkIGJ5IGh0dHBzOi8vc3dhZ2dlci5pby9kb2NzL3NwZWNpZmljYXRpb24vZGF0YS1tb2RlbHMvZGF0YS10eXBlcy9cbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0cy5GdW5jdGlvbkRlY2xhcmF0aW9uU2NoZW1hVHlwZSA9IHZvaWQgMDtcbihmdW5jdGlvbiAoRnVuY3Rpb25EZWNsYXJhdGlvblNjaGVtYVR5cGUpIHtcbiAgICAvKiogU3RyaW5nIHR5cGUuICovXG4gICAgRnVuY3Rpb25EZWNsYXJhdGlvblNjaGVtYVR5cGVbXCJTVFJJTkdcIl0gPSBcIlNUUklOR1wiO1xuICAgIC8qKiBOdW1iZXIgdHlwZS4gKi9cbiAgICBGdW5jdGlvbkRlY2xhcmF0aW9uU2NoZW1hVHlwZVtcIk5VTUJFUlwiXSA9IFwiTlVNQkVSXCI7XG4gICAgLyoqIEludGVnZXIgdHlwZS4gKi9cbiAgICBGdW5jdGlvbkRlY2xhcmF0aW9uU2NoZW1hVHlwZVtcIklOVEVHRVJcIl0gPSBcIklOVEVHRVJcIjtcbiAgICAvKiogQm9vbGVhbiB0eXBlLiAqL1xuICAgIEZ1bmN0aW9uRGVjbGFyYXRpb25TY2hlbWFUeXBlW1wiQk9PTEVBTlwiXSA9IFwiQk9PTEVBTlwiO1xuICAgIC8qKiBBcnJheSB0eXBlLiAqL1xuICAgIEZ1bmN0aW9uRGVjbGFyYXRpb25TY2hlbWFUeXBlW1wiQVJSQVlcIl0gPSBcIkFSUkFZXCI7XG4gICAgLyoqIE9iamVjdCB0eXBlLiAqL1xuICAgIEZ1bmN0aW9uRGVjbGFyYXRpb25TY2hlbWFUeXBlW1wiT0JKRUNUXCJdID0gXCJPQkpFQ1RcIjtcbn0pKGV4cG9ydHMuRnVuY3Rpb25EZWNsYXJhdGlvblNjaGVtYVR5cGUgfHwgKGV4cG9ydHMuRnVuY3Rpb25EZWNsYXJhdGlvblNjaGVtYVR5cGUgPSB7fSkpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyNCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBCYXNpYyBlcnJvciB0eXBlIGZvciB0aGlzIFNESy5cbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgR29vZ2xlR2VuZXJhdGl2ZUFJRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihgW0dvb2dsZUdlbmVyYXRpdmVBSSBFcnJvcl06ICR7bWVzc2FnZX1gKTtcbiAgICB9XG59XG4vKipcbiAqIEVycm9ycyBpbiB0aGUgY29udGVudHMgb2YgYSByZXNwb25zZSBmcm9tIHRoZSBtb2RlbC4gVGhpcyBpbmNsdWRlcyBwYXJzaW5nXG4gKiBlcnJvcnMsIG9yIHJlc3BvbnNlcyBpbmNsdWRpbmcgYSBzYWZldHkgYmxvY2sgcmVhc29uLlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBHb29nbGVHZW5lcmF0aXZlQUlSZXNwb25zZUVycm9yIGV4dGVuZHMgR29vZ2xlR2VuZXJhdGl2ZUFJRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHJlc3BvbnNlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgICAgICB0aGlzLnJlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgfVxufVxuLyoqXG4gKiBFcnJvciBjbGFzcyBjb3ZlcmluZyBIVFRQIGVycm9ycyB3aGVuIGNhbGxpbmcgdGhlIHNlcnZlci4gSW5jbHVkZXMgSFRUUFxuICogc3RhdHVzLCBzdGF0dXNUZXh0LCBhbmQgb3B0aW9uYWwgZGV0YWlscywgaWYgcHJvdmlkZWQgaW4gdGhlIHNlcnZlciByZXNwb25zZS5cbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgR29vZ2xlR2VuZXJhdGl2ZUFJRmV0Y2hFcnJvciBleHRlbmRzIEdvb2dsZUdlbmVyYXRpdmVBSUVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBzdGF0dXMsIHN0YXR1c1RleHQsIGVycm9yRGV0YWlscykge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgIHRoaXMuc3RhdHVzVGV4dCA9IHN0YXR1c1RleHQ7XG4gICAgICAgIHRoaXMuZXJyb3JEZXRhaWxzID0gZXJyb3JEZXRhaWxzO1xuICAgIH1cbn1cbi8qKlxuICogRXJyb3JzIGluIHRoZSBjb250ZW50cyBvZiBhIHJlcXVlc3Qgb3JpZ2luYXRpbmcgZnJvbSB1c2VyIGlucHV0LlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBHb29nbGVHZW5lcmF0aXZlQUlSZXF1ZXN0SW5wdXRFcnJvciBleHRlbmRzIEdvb2dsZUdlbmVyYXRpdmVBSUVycm9yIHtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjQgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IERFRkFVTFRfQkFTRV9VUkwgPSBcImh0dHBzOi8vZ2VuZXJhdGl2ZWxhbmd1YWdlLmdvb2dsZWFwaXMuY29tXCI7XG5jb25zdCBERUZBVUxUX0FQSV9WRVJTSU9OID0gXCJ2MWJldGFcIjtcbi8qKlxuICogV2UgY2FuJ3QgYHJlcXVpcmVgIHBhY2thZ2UuanNvbiBpZiB0aGlzIHJ1bnMgb24gd2ViLiBXZSB3aWxsIHVzZSByb2xsdXAgdG9cbiAqIHN3YXAgaW4gdGhlIHZlcnNpb24gbnVtYmVyIGhlcmUgYXQgYnVpbGQgdGltZS5cbiAqL1xuY29uc3QgUEFDS0FHRV9WRVJTSU9OID0gXCIwLjExLjFcIjtcbmNvbnN0IFBBQ0tBR0VfTE9HX0hFQURFUiA9IFwiZ2VuYWktanNcIjtcbnZhciBUYXNrO1xuKGZ1bmN0aW9uIChUYXNrKSB7XG4gICAgVGFza1tcIkdFTkVSQVRFX0NPTlRFTlRcIl0gPSBcImdlbmVyYXRlQ29udGVudFwiO1xuICAgIFRhc2tbXCJTVFJFQU1fR0VORVJBVEVfQ09OVEVOVFwiXSA9IFwic3RyZWFtR2VuZXJhdGVDb250ZW50XCI7XG4gICAgVGFza1tcIkNPVU5UX1RPS0VOU1wiXSA9IFwiY291bnRUb2tlbnNcIjtcbiAgICBUYXNrW1wiRU1CRURfQ09OVEVOVFwiXSA9IFwiZW1iZWRDb250ZW50XCI7XG4gICAgVGFza1tcIkJBVENIX0VNQkVEX0NPTlRFTlRTXCJdID0gXCJiYXRjaEVtYmVkQ29udGVudHNcIjtcbn0pKFRhc2sgfHwgKFRhc2sgPSB7fSkpO1xuY2xhc3MgUmVxdWVzdFVybCB7XG4gICAgY29uc3RydWN0b3IobW9kZWwsIHRhc2ssIGFwaUtleSwgc3RyZWFtLCByZXF1ZXN0T3B0aW9ucykge1xuICAgICAgICB0aGlzLm1vZGVsID0gbW9kZWw7XG4gICAgICAgIHRoaXMudGFzayA9IHRhc2s7XG4gICAgICAgIHRoaXMuYXBpS2V5ID0gYXBpS2V5O1xuICAgICAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTtcbiAgICAgICAgdGhpcy5yZXF1ZXN0T3B0aW9ucyA9IHJlcXVlc3RPcHRpb25zO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgYXBpVmVyc2lvbiA9ICgoX2EgPSB0aGlzLnJlcXVlc3RPcHRpb25zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYXBpVmVyc2lvbikgfHwgREVGQVVMVF9BUElfVkVSU0lPTjtcbiAgICAgICAgY29uc3QgYmFzZVVybCA9ICgoX2IgPSB0aGlzLnJlcXVlc3RPcHRpb25zKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYmFzZVVybCkgfHwgREVGQVVMVF9CQVNFX1VSTDtcbiAgICAgICAgbGV0IHVybCA9IGAke2Jhc2VVcmx9LyR7YXBpVmVyc2lvbn0vJHt0aGlzLm1vZGVsfToke3RoaXMudGFza31gO1xuICAgICAgICBpZiAodGhpcy5zdHJlYW0pIHtcbiAgICAgICAgICAgIHVybCArPSBcIj9hbHQ9c3NlXCI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVybDtcbiAgICB9XG59XG4vKipcbiAqIFNpbXBsZSwgYnV0IG1heSBiZWNvbWUgbW9yZSBjb21wbGV4IGlmIHdlIGFkZCBtb3JlIHZlcnNpb25zIHRvIGxvZy5cbiAqL1xuZnVuY3Rpb24gZ2V0Q2xpZW50SGVhZGVycyhyZXF1ZXN0T3B0aW9ucykge1xuICAgIGNvbnN0IGNsaWVudEhlYWRlcnMgPSBbXTtcbiAgICBpZiAocmVxdWVzdE9wdGlvbnMgPT09IG51bGwgfHwgcmVxdWVzdE9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlcXVlc3RPcHRpb25zLmFwaUNsaWVudCkge1xuICAgICAgICBjbGllbnRIZWFkZXJzLnB1c2gocmVxdWVzdE9wdGlvbnMuYXBpQ2xpZW50KTtcbiAgICB9XG4gICAgY2xpZW50SGVhZGVycy5wdXNoKGAke1BBQ0tBR0VfTE9HX0hFQURFUn0vJHtQQUNLQUdFX1ZFUlNJT059YCk7XG4gICAgcmV0dXJuIGNsaWVudEhlYWRlcnMuam9pbihcIiBcIik7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRIZWFkZXJzKHVybCkge1xuICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICAgIGhlYWRlcnMuYXBwZW5kKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICBoZWFkZXJzLmFwcGVuZChcIngtZ29vZy1hcGktY2xpZW50XCIsIGdldENsaWVudEhlYWRlcnModXJsLnJlcXVlc3RPcHRpb25zKSk7XG4gICAgaGVhZGVycy5hcHBlbmQoXCJ4LWdvb2ctYXBpLWtleVwiLCB1cmwuYXBpS2V5KTtcbiAgICBsZXQgY3VzdG9tSGVhZGVycyA9IHVybC5yZXF1ZXN0T3B0aW9ucy5jdXN0b21IZWFkZXJzO1xuICAgIGlmIChjdXN0b21IZWFkZXJzKSB7XG4gICAgICAgIGlmICghKGN1c3RvbUhlYWRlcnMgaW5zdGFuY2VvZiBIZWFkZXJzKSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjdXN0b21IZWFkZXJzID0gbmV3IEhlYWRlcnMoY3VzdG9tSGVhZGVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBHb29nbGVHZW5lcmF0aXZlQUlSZXF1ZXN0SW5wdXRFcnJvcihgdW5hYmxlIHRvIGNvbnZlcnQgY3VzdG9tSGVhZGVycyB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGN1c3RvbUhlYWRlcnMpfSB0byBIZWFkZXJzOiAke2UubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IFtoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZV0gb2YgY3VzdG9tSGVhZGVycy5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGlmIChoZWFkZXJOYW1lID09PSBcIngtZ29vZy1hcGkta2V5XCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR29vZ2xlR2VuZXJhdGl2ZUFJUmVxdWVzdElucHV0RXJyb3IoYENhbm5vdCBzZXQgcmVzZXJ2ZWQgaGVhZGVyIG5hbWUgJHtoZWFkZXJOYW1lfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaGVhZGVyTmFtZSA9PT0gXCJ4LWdvb2ctYXBpLWNsaWVudFwiKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdvb2dsZUdlbmVyYXRpdmVBSVJlcXVlc3RJbnB1dEVycm9yKGBIZWFkZXIgbmFtZSAke2hlYWRlck5hbWV9IGNhbiBvbmx5IGJlIHNldCB1c2luZyB0aGUgYXBpQ2xpZW50IGZpZWxkYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBoZWFkZXJzLmFwcGVuZChoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGhlYWRlcnM7XG59XG5hc3luYyBmdW5jdGlvbiBjb25zdHJ1Y3RSZXF1ZXN0KG1vZGVsLCB0YXNrLCBhcGlLZXksIHN0cmVhbSwgYm9keSwgcmVxdWVzdE9wdGlvbnMpIHtcbiAgICBjb25zdCB1cmwgPSBuZXcgUmVxdWVzdFVybChtb2RlbCwgdGFzaywgYXBpS2V5LCBzdHJlYW0sIHJlcXVlc3RPcHRpb25zKTtcbiAgICByZXR1cm4ge1xuICAgICAgICB1cmw6IHVybC50b1N0cmluZygpLFxuICAgICAgICBmZXRjaE9wdGlvbnM6IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgYnVpbGRGZXRjaE9wdGlvbnMocmVxdWVzdE9wdGlvbnMpKSwgeyBtZXRob2Q6IFwiUE9TVFwiLCBoZWFkZXJzOiBhd2FpdCBnZXRIZWFkZXJzKHVybCksIGJvZHkgfSksXG4gICAgfTtcbn1cbi8qKlxuICogV3JhcHBlciBmb3IgX21ha2VSZXF1ZXN0SW50ZXJuYWwgdGhhdCBhdXRvbWF0aWNhbGx5IHVzZXMgbmF0aXZlIGZldGNoLFxuICogYWxsb3dpbmcgX21ha2VSZXF1ZXN0SW50ZXJuYWwgdG8gYmUgdGVzdGVkIHdpdGggYSBtb2NrZWQgZmV0Y2ggZnVuY3Rpb24uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIG1ha2VSZXF1ZXN0KG1vZGVsLCB0YXNrLCBhcGlLZXksIHN0cmVhbSwgYm9keSwgcmVxdWVzdE9wdGlvbnMpIHtcbiAgICByZXR1cm4gX21ha2VSZXF1ZXN0SW50ZXJuYWwobW9kZWwsIHRhc2ssIGFwaUtleSwgc3RyZWFtLCBib2R5LCByZXF1ZXN0T3B0aW9ucywgZmV0Y2gpO1xufVxuYXN5bmMgZnVuY3Rpb24gX21ha2VSZXF1ZXN0SW50ZXJuYWwobW9kZWwsIHRhc2ssIGFwaUtleSwgc3RyZWFtLCBib2R5LCByZXF1ZXN0T3B0aW9ucywgXG4vLyBBbGxvd3MgdGhpcyB0byBiZSBzdHViYmVkIGZvciB0ZXN0c1xuZmV0Y2hGbiA9IGZldGNoKSB7XG4gICAgY29uc3QgdXJsID0gbmV3IFJlcXVlc3RVcmwobW9kZWwsIHRhc2ssIGFwaUtleSwgc3RyZWFtLCByZXF1ZXN0T3B0aW9ucyk7XG4gICAgbGV0IHJlc3BvbnNlO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSBhd2FpdCBjb25zdHJ1Y3RSZXF1ZXN0KG1vZGVsLCB0YXNrLCBhcGlLZXksIHN0cmVhbSwgYm9keSwgcmVxdWVzdE9wdGlvbnMpO1xuICAgICAgICByZXNwb25zZSA9IGF3YWl0IGZldGNoRm4ocmVxdWVzdC51cmwsIHJlcXVlc3QuZmV0Y2hPcHRpb25zKTtcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICAgICAgbGV0IGVycm9yRGV0YWlscztcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgICAgICBtZXNzYWdlID0ganNvbi5lcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgICAgIGlmIChqc29uLmVycm9yLmRldGFpbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSArPSBgICR7SlNPTi5zdHJpbmdpZnkoanNvbi5lcnJvci5kZXRhaWxzKX1gO1xuICAgICAgICAgICAgICAgICAgICBlcnJvckRldGFpbHMgPSBqc29uLmVycm9yLmRldGFpbHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAvLyBpZ25vcmVkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgR29vZ2xlR2VuZXJhdGl2ZUFJRmV0Y2hFcnJvcihgRXJyb3IgZmV0Y2hpbmcgZnJvbSAke3VybC50b1N0cmluZygpfTogWyR7cmVzcG9uc2Uuc3RhdHVzfSAke3Jlc3BvbnNlLnN0YXR1c1RleHR9XSAke21lc3NhZ2V9YCwgcmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5zdGF0dXNUZXh0LCBlcnJvckRldGFpbHMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGxldCBlcnIgPSBlO1xuICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgR29vZ2xlR2VuZXJhdGl2ZUFJRmV0Y2hFcnJvciB8fFxuICAgICAgICAgICAgZSBpbnN0YW5jZW9mIEdvb2dsZUdlbmVyYXRpdmVBSVJlcXVlc3RJbnB1dEVycm9yKSkge1xuICAgICAgICAgICAgZXJyID0gbmV3IEdvb2dsZUdlbmVyYXRpdmVBSUVycm9yKGBFcnJvciBmZXRjaGluZyBmcm9tICR7dXJsLnRvU3RyaW5nKCl9OiAke2UubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIGVyci5zdGFjayA9IGUuc3RhY2s7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2U7XG59XG4vKipcbiAqIEdlbmVyYXRlcyB0aGUgcmVxdWVzdCBvcHRpb25zIHRvIGJlIHBhc3NlZCB0byB0aGUgZmV0Y2ggQVBJLlxuICogQHBhcmFtIHJlcXVlc3RPcHRpb25zIC0gVGhlIHVzZXItZGVmaW5lZCByZXF1ZXN0IG9wdGlvbnMuXG4gKiBAcmV0dXJucyBUaGUgZ2VuZXJhdGVkIHJlcXVlc3Qgb3B0aW9ucy5cbiAqL1xuZnVuY3Rpb24gYnVpbGRGZXRjaE9wdGlvbnMocmVxdWVzdE9wdGlvbnMpIHtcbiAgICBjb25zdCBmZXRjaE9wdGlvbnMgPSB7fTtcbiAgICBpZiAoKHJlcXVlc3RPcHRpb25zID09PSBudWxsIHx8IHJlcXVlc3RPcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXF1ZXN0T3B0aW9ucy50aW1lb3V0KSA+PSAwKSB7XG4gICAgICAgIGNvbnN0IGFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgY29uc3Qgc2lnbmFsID0gYWJvcnRDb250cm9sbGVyLnNpZ25hbDtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBhYm9ydENvbnRyb2xsZXIuYWJvcnQoKSwgcmVxdWVzdE9wdGlvbnMudGltZW91dCk7XG4gICAgICAgIGZldGNoT3B0aW9ucy5zaWduYWwgPSBzaWduYWw7XG4gICAgfVxuICAgIHJldHVybiBmZXRjaE9wdGlvbnM7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDI0IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFkZHMgY29udmVuaWVuY2UgaGVscGVyIG1ldGhvZHMgdG8gYSByZXNwb25zZSBvYmplY3QsIGluY2x1ZGluZyBzdHJlYW1cbiAqIGNodW5rcyAoYXMgbG9uZyBhcyBlYWNoIGNodW5rIGlzIGEgY29tcGxldGUgR2VuZXJhdGVDb250ZW50UmVzcG9uc2UgSlNPTikuXG4gKi9cbmZ1bmN0aW9uIGFkZEhlbHBlcnMocmVzcG9uc2UpIHtcbiAgICByZXNwb25zZS50ZXh0ID0gKCkgPT4ge1xuICAgICAgICBpZiAocmVzcG9uc2UuY2FuZGlkYXRlcyAmJiByZXNwb25zZS5jYW5kaWRhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5jYW5kaWRhdGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFRoaXMgcmVzcG9uc2UgaGFkICR7cmVzcG9uc2UuY2FuZGlkYXRlcy5sZW5ndGh9IGAgK1xuICAgICAgICAgICAgICAgICAgICBgY2FuZGlkYXRlcy4gUmV0dXJuaW5nIHRleHQgZnJvbSB0aGUgZmlyc3QgY2FuZGlkYXRlIG9ubHkuIGAgK1xuICAgICAgICAgICAgICAgICAgICBgQWNjZXNzIHJlc3BvbnNlLmNhbmRpZGF0ZXMgZGlyZWN0bHkgdG8gdXNlIHRoZSBvdGhlciBjYW5kaWRhdGVzLmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhhZEJhZEZpbmlzaFJlYXNvbihyZXNwb25zZS5jYW5kaWRhdGVzWzBdKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBHb29nbGVHZW5lcmF0aXZlQUlSZXNwb25zZUVycm9yKGAke2Zvcm1hdEJsb2NrRXJyb3JNZXNzYWdlKHJlc3BvbnNlKX1gLCByZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGV4dChyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UucHJvbXB0RmVlZGJhY2spIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBHb29nbGVHZW5lcmF0aXZlQUlSZXNwb25zZUVycm9yKGBUZXh0IG5vdCBhdmFpbGFibGUuICR7Zm9ybWF0QmxvY2tFcnJvck1lc3NhZ2UocmVzcG9uc2UpfWAsIHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFRPRE86IHJlbW92ZSBhdCBuZXh0IG1ham9yIHZlcnNpb25cbiAgICAgKi9cbiAgICByZXNwb25zZS5mdW5jdGlvbkNhbGwgPSAoKSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZS5jYW5kaWRhdGVzICYmIHJlc3BvbnNlLmNhbmRpZGF0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmNhbmRpZGF0ZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVGhpcyByZXNwb25zZSBoYWQgJHtyZXNwb25zZS5jYW5kaWRhdGVzLmxlbmd0aH0gYCArXG4gICAgICAgICAgICAgICAgICAgIGBjYW5kaWRhdGVzLiBSZXR1cm5pbmcgZnVuY3Rpb24gY2FsbHMgZnJvbSB0aGUgZmlyc3QgY2FuZGlkYXRlIG9ubHkuIGAgK1xuICAgICAgICAgICAgICAgICAgICBgQWNjZXNzIHJlc3BvbnNlLmNhbmRpZGF0ZXMgZGlyZWN0bHkgdG8gdXNlIHRoZSBvdGhlciBjYW5kaWRhdGVzLmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhhZEJhZEZpbmlzaFJlYXNvbihyZXNwb25zZS5jYW5kaWRhdGVzWzBdKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBHb29nbGVHZW5lcmF0aXZlQUlSZXNwb25zZUVycm9yKGAke2Zvcm1hdEJsb2NrRXJyb3JNZXNzYWdlKHJlc3BvbnNlKX1gLCByZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYHJlc3BvbnNlLmZ1bmN0aW9uQ2FsbCgpIGlzIGRlcHJlY2F0ZWQuIGAgK1xuICAgICAgICAgICAgICAgIGBVc2UgcmVzcG9uc2UuZnVuY3Rpb25DYWxscygpIGluc3RlYWQuYCk7XG4gICAgICAgICAgICByZXR1cm4gZ2V0RnVuY3Rpb25DYWxscyhyZXNwb25zZSlbMF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UucHJvbXB0RmVlZGJhY2spIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBHb29nbGVHZW5lcmF0aXZlQUlSZXNwb25zZUVycm9yKGBGdW5jdGlvbiBjYWxsIG5vdCBhdmFpbGFibGUuICR7Zm9ybWF0QmxvY2tFcnJvck1lc3NhZ2UocmVzcG9uc2UpfWAsIHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgcmVzcG9uc2UuZnVuY3Rpb25DYWxscyA9ICgpID0+IHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmNhbmRpZGF0ZXMgJiYgcmVzcG9uc2UuY2FuZGlkYXRlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuY2FuZGlkYXRlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBUaGlzIHJlc3BvbnNlIGhhZCAke3Jlc3BvbnNlLmNhbmRpZGF0ZXMubGVuZ3RofSBgICtcbiAgICAgICAgICAgICAgICAgICAgYGNhbmRpZGF0ZXMuIFJldHVybmluZyBmdW5jdGlvbiBjYWxscyBmcm9tIHRoZSBmaXJzdCBjYW5kaWRhdGUgb25seS4gYCArXG4gICAgICAgICAgICAgICAgICAgIGBBY2Nlc3MgcmVzcG9uc2UuY2FuZGlkYXRlcyBkaXJlY3RseSB0byB1c2UgdGhlIG90aGVyIGNhbmRpZGF0ZXMuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaGFkQmFkRmluaXNoUmVhc29uKHJlc3BvbnNlLmNhbmRpZGF0ZXNbMF0pKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdvb2dsZUdlbmVyYXRpdmVBSVJlc3BvbnNlRXJyb3IoYCR7Zm9ybWF0QmxvY2tFcnJvck1lc3NhZ2UocmVzcG9uc2UpfWAsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBnZXRGdW5jdGlvbkNhbGxzKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5wcm9tcHRGZWVkYmFjaykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEdvb2dsZUdlbmVyYXRpdmVBSVJlc3BvbnNlRXJyb3IoYEZ1bmN0aW9uIGNhbGwgbm90IGF2YWlsYWJsZS4gJHtmb3JtYXRCbG9ja0Vycm9yTWVzc2FnZShyZXNwb25zZSl9YCwgcmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG59XG4vKipcbiAqIFJldHVybnMgYWxsIHRleHQgZm91bmQgaW4gYWxsIHBhcnRzIG9mIGZpcnN0IGNhbmRpZGF0ZS5cbiAqL1xuZnVuY3Rpb24gZ2V0VGV4dChyZXNwb25zZSkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICBjb25zdCB0ZXh0U3RyaW5ncyA9IFtdO1xuICAgIGlmICgoX2IgPSAoX2EgPSByZXNwb25zZS5jYW5kaWRhdGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF0uY29udGVudCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnBhcnRzKSB7XG4gICAgICAgIGZvciAoY29uc3QgcGFydCBvZiAoX2QgPSAoX2MgPSByZXNwb25zZS5jYW5kaWRhdGVzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2NbMF0uY29udGVudCkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnBhcnRzKSB7XG4gICAgICAgICAgICBpZiAocGFydC50ZXh0KSB7XG4gICAgICAgICAgICAgICAgdGV4dFN0cmluZ3MucHVzaChwYXJ0LnRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmICh0ZXh0U3RyaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiB0ZXh0U3RyaW5ncy5qb2luKFwiXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxufVxuLyoqXG4gKiBSZXR1cm5zIGZ1bmN0aW9uQ2FsbCBvZiBmaXJzdCBjYW5kaWRhdGUuXG4gKi9cbmZ1bmN0aW9uIGdldEZ1bmN0aW9uQ2FsbHMocmVzcG9uc2UpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgY29uc3QgZnVuY3Rpb25DYWxscyA9IFtdO1xuICAgIGlmICgoX2IgPSAoX2EgPSByZXNwb25zZS5jYW5kaWRhdGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF0uY29udGVudCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnBhcnRzKSB7XG4gICAgICAgIGZvciAoY29uc3QgcGFydCBvZiAoX2QgPSAoX2MgPSByZXNwb25zZS5jYW5kaWRhdGVzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2NbMF0uY29udGVudCkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnBhcnRzKSB7XG4gICAgICAgICAgICBpZiAocGFydC5mdW5jdGlvbkNhbGwpIHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbkNhbGxzLnB1c2gocGFydC5mdW5jdGlvbkNhbGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChmdW5jdGlvbkNhbGxzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uQ2FsbHM7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbn1cbmNvbnN0IGJhZEZpbmlzaFJlYXNvbnMgPSBbZXhwb3J0cy5GaW5pc2hSZWFzb24uUkVDSVRBVElPTiwgZXhwb3J0cy5GaW5pc2hSZWFzb24uU0FGRVRZXTtcbmZ1bmN0aW9uIGhhZEJhZEZpbmlzaFJlYXNvbihjYW5kaWRhdGUpIHtcbiAgICByZXR1cm4gKCEhY2FuZGlkYXRlLmZpbmlzaFJlYXNvbiAmJlxuICAgICAgICBiYWRGaW5pc2hSZWFzb25zLmluY2x1ZGVzKGNhbmRpZGF0ZS5maW5pc2hSZWFzb24pKTtcbn1cbmZ1bmN0aW9uIGZvcm1hdEJsb2NrRXJyb3JNZXNzYWdlKHJlc3BvbnNlKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgbGV0IG1lc3NhZ2UgPSBcIlwiO1xuICAgIGlmICgoIXJlc3BvbnNlLmNhbmRpZGF0ZXMgfHwgcmVzcG9uc2UuY2FuZGlkYXRlcy5sZW5ndGggPT09IDApICYmXG4gICAgICAgIHJlc3BvbnNlLnByb21wdEZlZWRiYWNrKSB7XG4gICAgICAgIG1lc3NhZ2UgKz0gXCJSZXNwb25zZSB3YXMgYmxvY2tlZFwiO1xuICAgICAgICBpZiAoKF9hID0gcmVzcG9uc2UucHJvbXB0RmVlZGJhY2spID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5ibG9ja1JlYXNvbikge1xuICAgICAgICAgICAgbWVzc2FnZSArPSBgIGR1ZSB0byAke3Jlc3BvbnNlLnByb21wdEZlZWRiYWNrLmJsb2NrUmVhc29ufWA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChfYiA9IHJlc3BvbnNlLnByb21wdEZlZWRiYWNrKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYmxvY2tSZWFzb25NZXNzYWdlKSB7XG4gICAgICAgICAgICBtZXNzYWdlICs9IGA6ICR7cmVzcG9uc2UucHJvbXB0RmVlZGJhY2suYmxvY2tSZWFzb25NZXNzYWdlfWA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoKF9jID0gcmVzcG9uc2UuY2FuZGlkYXRlcykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jWzBdKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0Q2FuZGlkYXRlID0gcmVzcG9uc2UuY2FuZGlkYXRlc1swXTtcbiAgICAgICAgaWYgKGhhZEJhZEZpbmlzaFJlYXNvbihmaXJzdENhbmRpZGF0ZSkpIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgKz0gYENhbmRpZGF0ZSB3YXMgYmxvY2tlZCBkdWUgdG8gJHtmaXJzdENhbmRpZGF0ZS5maW5pc2hSZWFzb259YDtcbiAgICAgICAgICAgIGlmIChmaXJzdENhbmRpZGF0ZS5maW5pc2hNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZSArPSBgOiAke2ZpcnN0Q2FuZGlkYXRlLmZpbmlzaE1lc3NhZ2V9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZTtcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlLCBTdXBwcmVzc2VkRXJyb3IsIFN5bWJvbCAqL1xyXG5cclxuXHJcbmZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9fYXN5bmNHZW5lcmF0b3IodGhpc0FyZywgX2FyZ3VtZW50cywgZ2VuZXJhdG9yKSB7XHJcbiAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgdmFyIGcgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSksIGksIHEgPSBbXTtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyBpZiAoZ1tuXSkgaVtuXSA9IGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoYSwgYikgeyBxLnB1c2goW24sIHYsIGEsIGJdKSA+IDEgfHwgcmVzdW1lKG4sIHYpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gcmVzdW1lKG4sIHYpIHsgdHJ5IHsgc3RlcChnW25dKHYpKTsgfSBjYXRjaCAoZSkgeyBzZXR0bGUocVswXVszXSwgZSk7IH0gfVxyXG4gICAgZnVuY3Rpb24gc3RlcChyKSB7IHIudmFsdWUgaW5zdGFuY2VvZiBfX2F3YWl0ID8gUHJvbWlzZS5yZXNvbHZlKHIudmFsdWUudikudGhlbihmdWxmaWxsLCByZWplY3QpIDogc2V0dGxlKHFbMF1bMl0sIHIpOyB9XHJcbiAgICBmdW5jdGlvbiBmdWxmaWxsKHZhbHVlKSB7IHJlc3VtZShcIm5leHRcIiwgdmFsdWUpOyB9XHJcbiAgICBmdW5jdGlvbiByZWplY3QodmFsdWUpIHsgcmVzdW1lKFwidGhyb3dcIiwgdmFsdWUpOyB9XHJcbiAgICBmdW5jdGlvbiBzZXR0bGUoZiwgdikgeyBpZiAoZih2KSwgcS5zaGlmdCgpLCBxLmxlbmd0aCkgcmVzdW1lKHFbMF1bMF0sIHFbMF1bMV0pOyB9XHJcbn1cclxuXHJcbnR5cGVvZiBTdXBwcmVzc2VkRXJyb3IgPT09IFwiZnVuY3Rpb25cIiA/IFN1cHByZXNzZWRFcnJvciA6IGZ1bmN0aW9uIChlcnJvciwgc3VwcHJlc3NlZCwgbWVzc2FnZSkge1xyXG4gICAgdmFyIGUgPSBuZXcgRXJyb3IobWVzc2FnZSk7XHJcbiAgICByZXR1cm4gZS5uYW1lID0gXCJTdXBwcmVzc2VkRXJyb3JcIiwgZS5lcnJvciA9IGVycm9yLCBlLnN1cHByZXNzZWQgPSBzdXBwcmVzc2VkLCBlO1xyXG59O1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyNCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgcmVzcG9uc2VMaW5lUkUgPSAvXmRhdGFcXDogKC4qKSg/OlxcblxcbnxcXHJcXHJ8XFxyXFxuXFxyXFxuKS87XG4vKipcbiAqIFByb2Nlc3MgYSByZXNwb25zZS5ib2R5IHN0cmVhbSBmcm9tIHRoZSBiYWNrZW5kIGFuZCByZXR1cm4gYW5cbiAqIGl0ZXJhdG9yIHRoYXQgcHJvdmlkZXMgb25lIGNvbXBsZXRlIEdlbmVyYXRlQ29udGVudFJlc3BvbnNlIGF0IGEgdGltZVxuICogYW5kIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggYSBzaW5nbGUgYWdncmVnYXRlZFxuICogR2VuZXJhdGVDb250ZW50UmVzcG9uc2UuXG4gKlxuICogQHBhcmFtIHJlc3BvbnNlIC0gUmVzcG9uc2UgZnJvbSBhIGZldGNoIGNhbGxcbiAqL1xuZnVuY3Rpb24gcHJvY2Vzc1N0cmVhbShyZXNwb25zZSkge1xuICAgIGNvbnN0IGlucHV0U3RyZWFtID0gcmVzcG9uc2UuYm9keS5waXBlVGhyb3VnaChuZXcgVGV4dERlY29kZXJTdHJlYW0oXCJ1dGY4XCIsIHsgZmF0YWw6IHRydWUgfSkpO1xuICAgIGNvbnN0IHJlc3BvbnNlU3RyZWFtID0gZ2V0UmVzcG9uc2VTdHJlYW0oaW5wdXRTdHJlYW0pO1xuICAgIGNvbnN0IFtzdHJlYW0xLCBzdHJlYW0yXSA9IHJlc3BvbnNlU3RyZWFtLnRlZSgpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHN0cmVhbTogZ2VuZXJhdGVSZXNwb25zZVNlcXVlbmNlKHN0cmVhbTEpLFxuICAgICAgICByZXNwb25zZTogZ2V0UmVzcG9uc2VQcm9taXNlKHN0cmVhbTIpLFxuICAgIH07XG59XG5hc3luYyBmdW5jdGlvbiBnZXRSZXNwb25zZVByb21pc2Uoc3RyZWFtKSB7XG4gICAgY29uc3QgYWxsUmVzcG9uc2VzID0gW107XG4gICAgY29uc3QgcmVhZGVyID0gc3RyZWFtLmdldFJlYWRlcigpO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGNvbnN0IHsgZG9uZSwgdmFsdWUgfSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7XG4gICAgICAgIGlmIChkb25lKSB7XG4gICAgICAgICAgICByZXR1cm4gYWRkSGVscGVycyhhZ2dyZWdhdGVSZXNwb25zZXMoYWxsUmVzcG9uc2VzKSk7XG4gICAgICAgIH1cbiAgICAgICAgYWxsUmVzcG9uc2VzLnB1c2godmFsdWUpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdlbmVyYXRlUmVzcG9uc2VTZXF1ZW5jZShzdHJlYW0pIHtcbiAgICByZXR1cm4gX19hc3luY0dlbmVyYXRvcih0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKiBnZW5lcmF0ZVJlc3BvbnNlU2VxdWVuY2VfMSgpIHtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gc3RyZWFtLmdldFJlYWRlcigpO1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgY29uc3QgeyB2YWx1ZSwgZG9uZSB9ID0geWllbGQgX19hd2FpdChyZWFkZXIucmVhZCgpKTtcbiAgICAgICAgICAgIGlmIChkb25lKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB5aWVsZCB5aWVsZCBfX2F3YWl0KGFkZEhlbHBlcnModmFsdWUpKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuLyoqXG4gKiBSZWFkcyBhIHJhdyBzdHJlYW0gZnJvbSB0aGUgZmV0Y2ggcmVzcG9uc2UgYW5kIGpvaW4gaW5jb21wbGV0ZVxuICogY2h1bmtzLCByZXR1cm5pbmcgYSBuZXcgc3RyZWFtIHRoYXQgcHJvdmlkZXMgYSBzaW5nbGUgY29tcGxldGVcbiAqIEdlbmVyYXRlQ29udGVudFJlc3BvbnNlIGluIGVhY2ggaXRlcmF0aW9uLlxuICovXG5mdW5jdGlvbiBnZXRSZXNwb25zZVN0cmVhbShpbnB1dFN0cmVhbSkge1xuICAgIGNvbnN0IHJlYWRlciA9IGlucHV0U3RyZWFtLmdldFJlYWRlcigpO1xuICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBSZWFkYWJsZVN0cmVhbSh7XG4gICAgICAgIHN0YXJ0KGNvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgIGxldCBjdXJyZW50VGV4dCA9IFwiXCI7XG4gICAgICAgICAgICByZXR1cm4gcHVtcCgpO1xuICAgICAgICAgICAgZnVuY3Rpb24gcHVtcCgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVhZGVyLnJlYWQoKS50aGVuKCh7IHZhbHVlLCBkb25lIH0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VGV4dC50cmltKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyLmVycm9yKG5ldyBHb29nbGVHZW5lcmF0aXZlQUlFcnJvcihcIkZhaWxlZCB0byBwYXJzZSBzdHJlYW1cIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50VGV4dCArPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1hdGNoID0gY3VycmVudFRleHQubWF0Y2gocmVzcG9uc2VMaW5lUkUpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgcGFyc2VkUmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZWRSZXNwb25zZSA9IEpTT04ucGFyc2UobWF0Y2hbMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyLmVycm9yKG5ldyBHb29nbGVHZW5lcmF0aXZlQUlFcnJvcihgRXJyb3IgcGFyc2luZyBKU09OIHJlc3BvbnNlOiBcIiR7bWF0Y2hbMV19XCJgKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHBhcnNlZFJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUZXh0ID0gY3VycmVudFRleHQuc3Vic3RyaW5nKG1hdGNoWzBdLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGN1cnJlbnRUZXh0Lm1hdGNoKHJlc3BvbnNlTGluZVJFKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHVtcCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgIH0pO1xuICAgIHJldHVybiBzdHJlYW07XG59XG4vKipcbiAqIEFnZ3JlZ2F0ZXMgYW4gYXJyYXkgb2YgYEdlbmVyYXRlQ29udGVudFJlc3BvbnNlYHMgaW50byBhIHNpbmdsZVxuICogR2VuZXJhdGVDb250ZW50UmVzcG9uc2UuXG4gKi9cbmZ1bmN0aW9uIGFnZ3JlZ2F0ZVJlc3BvbnNlcyhyZXNwb25zZXMpIHtcbiAgICBjb25zdCBsYXN0UmVzcG9uc2UgPSByZXNwb25zZXNbcmVzcG9uc2VzLmxlbmd0aCAtIDFdO1xuICAgIGNvbnN0IGFnZ3JlZ2F0ZWRSZXNwb25zZSA9IHtcbiAgICAgICAgcHJvbXB0RmVlZGJhY2s6IGxhc3RSZXNwb25zZSA9PT0gbnVsbCB8fCBsYXN0UmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxhc3RSZXNwb25zZS5wcm9tcHRGZWVkYmFjayxcbiAgICB9O1xuICAgIGZvciAoY29uc3QgcmVzcG9uc2Ugb2YgcmVzcG9uc2VzKSB7XG4gICAgICAgIGlmIChyZXNwb25zZS5jYW5kaWRhdGVzKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNhbmRpZGF0ZSBvZiByZXNwb25zZS5jYW5kaWRhdGVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IGNhbmRpZGF0ZS5pbmRleDtcbiAgICAgICAgICAgICAgICBpZiAoIWFnZ3JlZ2F0ZWRSZXNwb25zZS5jYW5kaWRhdGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZWRSZXNwb25zZS5jYW5kaWRhdGVzID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghYWdncmVnYXRlZFJlc3BvbnNlLmNhbmRpZGF0ZXNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgYWdncmVnYXRlZFJlc3BvbnNlLmNhbmRpZGF0ZXNbaV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogY2FuZGlkYXRlLmluZGV4LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBLZWVwIG92ZXJ3cml0aW5nLCB0aGUgbGFzdCBvbmUgd2lsbCBiZSBmaW5hbFxuICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZWRSZXNwb25zZS5jYW5kaWRhdGVzW2ldLmNpdGF0aW9uTWV0YWRhdGEgPVxuICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUuY2l0YXRpb25NZXRhZGF0YTtcbiAgICAgICAgICAgICAgICBhZ2dyZWdhdGVkUmVzcG9uc2UuY2FuZGlkYXRlc1tpXS5maW5pc2hSZWFzb24gPSBjYW5kaWRhdGUuZmluaXNoUmVhc29uO1xuICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZWRSZXNwb25zZS5jYW5kaWRhdGVzW2ldLmZpbmlzaE1lc3NhZ2UgPVxuICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUuZmluaXNoTWVzc2FnZTtcbiAgICAgICAgICAgICAgICBhZ2dyZWdhdGVkUmVzcG9uc2UuY2FuZGlkYXRlc1tpXS5zYWZldHlSYXRpbmdzID1cbiAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlLnNhZmV0eVJhdGluZ3M7XG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ2FuZGlkYXRlcyBzaG91bGQgYWx3YXlzIGhhdmUgY29udGVudCBhbmQgcGFydHMsIGJ1dCB0aGlzIGhhbmRsZXNcbiAgICAgICAgICAgICAgICAgKiBwb3NzaWJsZSBtYWxmb3JtZWQgcmVzcG9uc2VzLlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGlmIChjYW5kaWRhdGUuY29udGVudCAmJiBjYW5kaWRhdGUuY29udGVudC5wYXJ0cykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWFnZ3JlZ2F0ZWRSZXNwb25zZS5jYW5kaWRhdGVzW2ldLmNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZWRSZXNwb25zZS5jYW5kaWRhdGVzW2ldLmNvbnRlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9sZTogY2FuZGlkYXRlLmNvbnRlbnQucm9sZSB8fCBcInVzZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0czogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1BhcnQgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIGNhbmRpZGF0ZS5jb250ZW50LnBhcnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydC50ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3UGFydC50ZXh0ID0gcGFydC50ZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnQuZnVuY3Rpb25DYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3UGFydC5mdW5jdGlvbkNhbGwgPSBwYXJ0LmZ1bmN0aW9uQ2FsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhuZXdQYXJ0KS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdQYXJ0LnRleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYWdncmVnYXRlZFJlc3BvbnNlLmNhbmRpZGF0ZXNbaV0uY29udGVudC5wYXJ0cy5wdXNoKG5ld1BhcnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhZ2dyZWdhdGVkUmVzcG9uc2U7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDI0IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUNvbnRlbnRTdHJlYW0oYXBpS2V5LCBtb2RlbCwgcGFyYW1zLCByZXF1ZXN0T3B0aW9ucykge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbWFrZVJlcXVlc3QobW9kZWwsIFRhc2suU1RSRUFNX0dFTkVSQVRFX0NPTlRFTlQsIGFwaUtleSwgXG4gICAgLyogc3RyZWFtICovIHRydWUsIEpTT04uc3RyaW5naWZ5KHBhcmFtcyksIHJlcXVlc3RPcHRpb25zKTtcbiAgICByZXR1cm4gcHJvY2Vzc1N0cmVhbShyZXNwb25zZSk7XG59XG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUNvbnRlbnQoYXBpS2V5LCBtb2RlbCwgcGFyYW1zLCByZXF1ZXN0T3B0aW9ucykge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbWFrZVJlcXVlc3QobW9kZWwsIFRhc2suR0VORVJBVEVfQ09OVEVOVCwgYXBpS2V5LCBcbiAgICAvKiBzdHJlYW0gKi8gZmFsc2UsIEpTT04uc3RyaW5naWZ5KHBhcmFtcyksIHJlcXVlc3RPcHRpb25zKTtcbiAgICBjb25zdCByZXNwb25zZUpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgY29uc3QgZW5oYW5jZWRSZXNwb25zZSA9IGFkZEhlbHBlcnMocmVzcG9uc2VKc29uKTtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXNwb25zZTogZW5oYW5jZWRSZXNwb25zZSxcbiAgICB9O1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyNCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuZnVuY3Rpb24gZm9ybWF0U3lzdGVtSW5zdHJ1Y3Rpb24oaW5wdXQpIHtcbiAgICAvLyBudWxsIG9yIHVuZGVmaW5lZFxuICAgIGlmIChpbnB1dCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4geyByb2xlOiBcInN5c3RlbVwiLCBwYXJ0czogW3sgdGV4dDogaW5wdXQgfV0gfTtcbiAgICB9XG4gICAgZWxzZSBpZiAoaW5wdXQudGV4dCkge1xuICAgICAgICByZXR1cm4geyByb2xlOiBcInN5c3RlbVwiLCBwYXJ0czogW2lucHV0XSB9O1xuICAgIH1cbiAgICBlbHNlIGlmIChpbnB1dC5wYXJ0cykge1xuICAgICAgICBpZiAoIWlucHV0LnJvbGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHJvbGU6IFwic3lzdGVtXCIsIHBhcnRzOiBpbnB1dC5wYXJ0cyB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZm9ybWF0TmV3Q29udGVudChyZXF1ZXN0KSB7XG4gICAgbGV0IG5ld1BhcnRzID0gW107XG4gICAgaWYgKHR5cGVvZiByZXF1ZXN0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIG5ld1BhcnRzID0gW3sgdGV4dDogcmVxdWVzdCB9XTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGZvciAoY29uc3QgcGFydE9yU3RyaW5nIG9mIHJlcXVlc3QpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcGFydE9yU3RyaW5nID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgbmV3UGFydHMucHVzaCh7IHRleHQ6IHBhcnRPclN0cmluZyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld1BhcnRzLnB1c2gocGFydE9yU3RyaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYXNzaWduUm9sZVRvUGFydHNBbmRWYWxpZGF0ZVNlbmRNZXNzYWdlUmVxdWVzdChuZXdQYXJ0cyk7XG59XG4vKipcbiAqIFdoZW4gbXVsdGlwbGUgUGFydCB0eXBlcyAoaS5lLiBGdW5jdGlvblJlc3BvbnNlUGFydCBhbmQgVGV4dFBhcnQpIGFyZVxuICogcGFzc2VkIGluIGEgc2luZ2xlIFBhcnQgYXJyYXksIHdlIG1heSBuZWVkIHRvIGFzc2lnbiBkaWZmZXJlbnQgcm9sZXMgdG8gZWFjaFxuICogcGFydC4gQ3VycmVudGx5IG9ubHkgRnVuY3Rpb25SZXNwb25zZVBhcnQgcmVxdWlyZXMgYSByb2xlIG90aGVyIHRoYW4gJ3VzZXInLlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSBwYXJ0cyBBcnJheSBvZiBwYXJ0cyB0byBwYXNzIHRvIHRoZSBtb2RlbFxuICogQHJldHVybnMgQXJyYXkgb2YgY29udGVudCBpdGVtc1xuICovXG5mdW5jdGlvbiBhc3NpZ25Sb2xlVG9QYXJ0c0FuZFZhbGlkYXRlU2VuZE1lc3NhZ2VSZXF1ZXN0KHBhcnRzKSB7XG4gICAgY29uc3QgdXNlckNvbnRlbnQgPSB7IHJvbGU6IFwidXNlclwiLCBwYXJ0czogW10gfTtcbiAgICBjb25zdCBmdW5jdGlvbkNvbnRlbnQgPSB7IHJvbGU6IFwiZnVuY3Rpb25cIiwgcGFydHM6IFtdIH07XG4gICAgbGV0IGhhc1VzZXJDb250ZW50ID0gZmFsc2U7XG4gICAgbGV0IGhhc0Z1bmN0aW9uQ29udGVudCA9IGZhbHNlO1xuICAgIGZvciAoY29uc3QgcGFydCBvZiBwYXJ0cykge1xuICAgICAgICBpZiAoXCJmdW5jdGlvblJlc3BvbnNlXCIgaW4gcGFydCkge1xuICAgICAgICAgICAgZnVuY3Rpb25Db250ZW50LnBhcnRzLnB1c2gocGFydCk7XG4gICAgICAgICAgICBoYXNGdW5jdGlvbkNvbnRlbnQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdXNlckNvbnRlbnQucGFydHMucHVzaChwYXJ0KTtcbiAgICAgICAgICAgIGhhc1VzZXJDb250ZW50ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoaGFzVXNlckNvbnRlbnQgJiYgaGFzRnVuY3Rpb25Db250ZW50KSB7XG4gICAgICAgIHRocm93IG5ldyBHb29nbGVHZW5lcmF0aXZlQUlFcnJvcihcIldpdGhpbiBhIHNpbmdsZSBtZXNzYWdlLCBGdW5jdGlvblJlc3BvbnNlIGNhbm5vdCBiZSBtaXhlZCB3aXRoIG90aGVyIHR5cGUgb2YgcGFydCBpbiB0aGUgcmVxdWVzdCBmb3Igc2VuZGluZyBjaGF0IG1lc3NhZ2UuXCIpO1xuICAgIH1cbiAgICBpZiAoIWhhc1VzZXJDb250ZW50ICYmICFoYXNGdW5jdGlvbkNvbnRlbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEdvb2dsZUdlbmVyYXRpdmVBSUVycm9yKFwiTm8gY29udGVudCBpcyBwcm92aWRlZCBmb3Igc2VuZGluZyBjaGF0IG1lc3NhZ2UuXCIpO1xuICAgIH1cbiAgICBpZiAoaGFzVXNlckNvbnRlbnQpIHtcbiAgICAgICAgcmV0dXJuIHVzZXJDb250ZW50O1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb25Db250ZW50O1xufVxuZnVuY3Rpb24gZm9ybWF0R2VuZXJhdGVDb250ZW50SW5wdXQocGFyYW1zKSB7XG4gICAgbGV0IGZvcm1hdHRlZFJlcXVlc3Q7XG4gICAgaWYgKHBhcmFtcy5jb250ZW50cykge1xuICAgICAgICBmb3JtYXR0ZWRSZXF1ZXN0ID0gcGFyYW1zO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gQXJyYXkgb3Igc3RyaW5nXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBmb3JtYXROZXdDb250ZW50KHBhcmFtcyk7XG4gICAgICAgIGZvcm1hdHRlZFJlcXVlc3QgPSB7IGNvbnRlbnRzOiBbY29udGVudF0gfTtcbiAgICB9XG4gICAgaWYgKHBhcmFtcy5zeXN0ZW1JbnN0cnVjdGlvbikge1xuICAgICAgICBmb3JtYXR0ZWRSZXF1ZXN0LnN5c3RlbUluc3RydWN0aW9uID0gZm9ybWF0U3lzdGVtSW5zdHJ1Y3Rpb24ocGFyYW1zLnN5c3RlbUluc3RydWN0aW9uKTtcbiAgICB9XG4gICAgcmV0dXJuIGZvcm1hdHRlZFJlcXVlc3Q7XG59XG5mdW5jdGlvbiBmb3JtYXRFbWJlZENvbnRlbnRJbnB1dChwYXJhbXMpIHtcbiAgICBpZiAodHlwZW9mIHBhcmFtcyA9PT0gXCJzdHJpbmdcIiB8fCBBcnJheS5pc0FycmF5KHBhcmFtcykpIHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGZvcm1hdE5ld0NvbnRlbnQocGFyYW1zKTtcbiAgICAgICAgcmV0dXJuIHsgY29udGVudCB9O1xuICAgIH1cbiAgICByZXR1cm4gcGFyYW1zO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyNCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gaHR0cHM6Ly9haS5nb29nbGUuZGV2L2FwaS9yZXN0L3YxYmV0YS9Db250ZW50I3BhcnRcbmNvbnN0IFZBTElEX1BBUlRfRklFTERTID0gW1xuICAgIFwidGV4dFwiLFxuICAgIFwiaW5saW5lRGF0YVwiLFxuICAgIFwiZnVuY3Rpb25DYWxsXCIsXG4gICAgXCJmdW5jdGlvblJlc3BvbnNlXCIsXG5dO1xuY29uc3QgVkFMSURfUEFSVFNfUEVSX1JPTEUgPSB7XG4gICAgdXNlcjogW1widGV4dFwiLCBcImlubGluZURhdGFcIl0sXG4gICAgZnVuY3Rpb246IFtcImZ1bmN0aW9uUmVzcG9uc2VcIl0sXG4gICAgbW9kZWw6IFtcInRleHRcIiwgXCJmdW5jdGlvbkNhbGxcIl0sXG4gICAgLy8gU3lzdGVtIGluc3RydWN0aW9ucyBzaG91bGRuJ3QgYmUgaW4gaGlzdG9yeSBhbnl3YXkuXG4gICAgc3lzdGVtOiBbXCJ0ZXh0XCJdLFxufTtcbmNvbnN0IFZBTElEX1BSRVZJT1VTX0NPTlRFTlRfUk9MRVMgPSB7XG4gICAgdXNlcjogW1wibW9kZWxcIl0sXG4gICAgZnVuY3Rpb246IFtcIm1vZGVsXCJdLFxuICAgIG1vZGVsOiBbXCJ1c2VyXCIsIFwiZnVuY3Rpb25cIl0sXG4gICAgLy8gU3lzdGVtIGluc3RydWN0aW9ucyBzaG91bGRuJ3QgYmUgaW4gaGlzdG9yeS5cbiAgICBzeXN0ZW06IFtdLFxufTtcbmZ1bmN0aW9uIHZhbGlkYXRlQ2hhdEhpc3RvcnkoaGlzdG9yeSkge1xuICAgIGxldCBwcmV2Q29udGVudDtcbiAgICBmb3IgKGNvbnN0IGN1cnJDb250ZW50IG9mIGhpc3RvcnkpIHtcbiAgICAgICAgY29uc3QgeyByb2xlLCBwYXJ0cyB9ID0gY3VyckNvbnRlbnQ7XG4gICAgICAgIGlmICghcHJldkNvbnRlbnQgJiYgcm9sZSAhPT0gXCJ1c2VyXCIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBHb29nbGVHZW5lcmF0aXZlQUlFcnJvcihgRmlyc3QgY29udGVudCBzaG91bGQgYmUgd2l0aCByb2xlICd1c2VyJywgZ290ICR7cm9sZX1gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIVBPU1NJQkxFX1JPTEVTLmluY2x1ZGVzKHJvbGUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgR29vZ2xlR2VuZXJhdGl2ZUFJRXJyb3IoYEVhY2ggaXRlbSBzaG91bGQgaW5jbHVkZSByb2xlIGZpZWxkLiBHb3QgJHtyb2xlfSBidXQgdmFsaWQgcm9sZXMgYXJlOiAke0pTT04uc3RyaW5naWZ5KFBPU1NJQkxFX1JPTEVTKX1gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGFydHMpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgR29vZ2xlR2VuZXJhdGl2ZUFJRXJyb3IoXCJDb250ZW50IHNob3VsZCBoYXZlICdwYXJ0cycgcHJvcGVydHkgd2l0aCBhbiBhcnJheSBvZiBQYXJ0c1wiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgR29vZ2xlR2VuZXJhdGl2ZUFJRXJyb3IoXCJFYWNoIENvbnRlbnQgc2hvdWxkIGhhdmUgYXQgbGVhc3Qgb25lIHBhcnRcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY291bnRGaWVsZHMgPSB7XG4gICAgICAgICAgICB0ZXh0OiAwLFxuICAgICAgICAgICAgaW5saW5lRGF0YTogMCxcbiAgICAgICAgICAgIGZ1bmN0aW9uQ2FsbDogMCxcbiAgICAgICAgICAgIGZ1bmN0aW9uUmVzcG9uc2U6IDAsXG4gICAgICAgICAgICBmaWxlRGF0YTogMCxcbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIHBhcnRzKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBWQUxJRF9QQVJUX0ZJRUxEUykge1xuICAgICAgICAgICAgICAgIGlmIChrZXkgaW4gcGFydCkge1xuICAgICAgICAgICAgICAgICAgICBjb3VudEZpZWxkc1trZXldICs9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbGlkUGFydHMgPSBWQUxJRF9QQVJUU19QRVJfUk9MRVtyb2xlXTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgVkFMSURfUEFSVF9GSUVMRFMpIHtcbiAgICAgICAgICAgIGlmICghdmFsaWRQYXJ0cy5pbmNsdWRlcyhrZXkpICYmIGNvdW50RmllbGRzW2tleV0gPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdvb2dsZUdlbmVyYXRpdmVBSUVycm9yKGBDb250ZW50IHdpdGggcm9sZSAnJHtyb2xlfScgY2FuJ3QgY29udGFpbiAnJHtrZXl9JyBwYXJ0YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByZXZDb250ZW50KSB7XG4gICAgICAgICAgICBjb25zdCB2YWxpZFByZXZpb3VzQ29udGVudFJvbGVzID0gVkFMSURfUFJFVklPVVNfQ09OVEVOVF9ST0xFU1tyb2xlXTtcbiAgICAgICAgICAgIGlmICghdmFsaWRQcmV2aW91c0NvbnRlbnRSb2xlcy5pbmNsdWRlcyhwcmV2Q29udGVudC5yb2xlKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBHb29nbGVHZW5lcmF0aXZlQUlFcnJvcihgQ29udGVudCB3aXRoIHJvbGUgJyR7cm9sZX0nIGNhbid0IGZvbGxvdyAnJHtwcmV2Q29udGVudC5yb2xlfScuIFZhbGlkIHByZXZpb3VzIHJvbGVzOiAke0pTT04uc3RyaW5naWZ5KFZBTElEX1BSRVZJT1VTX0NPTlRFTlRfUk9MRVMpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHByZXZDb250ZW50ID0gY3VyckNvbnRlbnQ7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyNCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBEbyBub3QgbG9nIGEgbWVzc2FnZSBmb3IgdGhpcyBlcnJvci5cbiAqL1xuY29uc3QgU0lMRU5UX0VSUk9SID0gXCJTSUxFTlRfRVJST1JcIjtcbi8qKlxuICogQ2hhdFNlc3Npb24gY2xhc3MgdGhhdCBlbmFibGVzIHNlbmRpbmcgY2hhdCBtZXNzYWdlcyBhbmQgc3RvcmVzXG4gKiBoaXN0b3J5IG9mIHNlbnQgYW5kIHJlY2VpdmVkIG1lc3NhZ2VzIHNvIGZhci5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIENoYXRTZXNzaW9uIHtcbiAgICBjb25zdHJ1Y3RvcihhcGlLZXksIG1vZGVsLCBwYXJhbXMsIHJlcXVlc3RPcHRpb25zKSB7XG4gICAgICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcbiAgICAgICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XG4gICAgICAgIHRoaXMucmVxdWVzdE9wdGlvbnMgPSByZXF1ZXN0T3B0aW9ucztcbiAgICAgICAgdGhpcy5faGlzdG9yeSA9IFtdO1xuICAgICAgICB0aGlzLl9zZW5kUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB0aGlzLl9hcGlLZXkgPSBhcGlLZXk7XG4gICAgICAgIGlmIChwYXJhbXMgPT09IG51bGwgfHwgcGFyYW1zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXJhbXMuaGlzdG9yeSkge1xuICAgICAgICAgICAgdmFsaWRhdGVDaGF0SGlzdG9yeShwYXJhbXMuaGlzdG9yeSk7XG4gICAgICAgICAgICB0aGlzLl9oaXN0b3J5ID0gcGFyYW1zLmhpc3Rvcnk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgY2hhdCBoaXN0b3J5IHNvIGZhci4gQmxvY2tlZCBwcm9tcHRzIGFyZSBub3QgYWRkZWQgdG8gaGlzdG9yeS5cbiAgICAgKiBCbG9ja2VkIGNhbmRpZGF0ZXMgYXJlIG5vdCBhZGRlZCB0byBoaXN0b3J5LCBub3IgYXJlIHRoZSBwcm9tcHRzIHRoYXRcbiAgICAgKiBnZW5lcmF0ZWQgdGhlbS5cbiAgICAgKi9cbiAgICBhc3luYyBnZXRIaXN0b3J5KCkge1xuICAgICAgICBhd2FpdCB0aGlzLl9zZW5kUHJvbWlzZTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hpc3Rvcnk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNlbmRzIGEgY2hhdCBtZXNzYWdlIGFuZCByZWNlaXZlcyBhIG5vbi1zdHJlYW1pbmdcbiAgICAgKiB7QGxpbmsgR2VuZXJhdGVDb250ZW50UmVzdWx0fVxuICAgICAqL1xuICAgIGFzeW5jIHNlbmRNZXNzYWdlKHJlcXVlc3QpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICAgICAgYXdhaXQgdGhpcy5fc2VuZFByb21pc2U7XG4gICAgICAgIGNvbnN0IG5ld0NvbnRlbnQgPSBmb3JtYXROZXdDb250ZW50KHJlcXVlc3QpO1xuICAgICAgICBjb25zdCBnZW5lcmF0ZUNvbnRlbnRSZXF1ZXN0ID0ge1xuICAgICAgICAgICAgc2FmZXR5U2V0dGluZ3M6IChfYSA9IHRoaXMucGFyYW1zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2FmZXR5U2V0dGluZ3MsXG4gICAgICAgICAgICBnZW5lcmF0aW9uQ29uZmlnOiAoX2IgPSB0aGlzLnBhcmFtcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmdlbmVyYXRpb25Db25maWcsXG4gICAgICAgICAgICB0b29sczogKF9jID0gdGhpcy5wYXJhbXMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy50b29scyxcbiAgICAgICAgICAgIHRvb2xDb25maWc6IChfZCA9IHRoaXMucGFyYW1zKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QudG9vbENvbmZpZyxcbiAgICAgICAgICAgIHN5c3RlbUluc3RydWN0aW9uOiAoX2UgPSB0aGlzLnBhcmFtcykgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLnN5c3RlbUluc3RydWN0aW9uLFxuICAgICAgICAgICAgY29udGVudHM6IFsuLi50aGlzLl9oaXN0b3J5LCBuZXdDb250ZW50XSxcbiAgICAgICAgfTtcbiAgICAgICAgbGV0IGZpbmFsUmVzdWx0O1xuICAgICAgICAvLyBBZGQgb250byB0aGUgY2hhaW4uXG4gICAgICAgIHRoaXMuX3NlbmRQcm9taXNlID0gdGhpcy5fc2VuZFByb21pc2VcbiAgICAgICAgICAgIC50aGVuKCgpID0+IGdlbmVyYXRlQ29udGVudCh0aGlzLl9hcGlLZXksIHRoaXMubW9kZWwsIGdlbmVyYXRlQ29udGVudFJlcXVlc3QsIHRoaXMucmVxdWVzdE9wdGlvbnMpKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5yZXNwb25zZS5jYW5kaWRhdGVzICYmXG4gICAgICAgICAgICAgICAgcmVzdWx0LnJlc3BvbnNlLmNhbmRpZGF0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hpc3RvcnkucHVzaChuZXdDb250ZW50KTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZUNvbnRlbnQgPSBPYmplY3QuYXNzaWduKHsgcGFydHM6IFtdLCBcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVzcG9uc2Ugc2VlbXMgdG8gY29tZSBiYWNrIHdpdGhvdXQgYSByb2xlIHNldC5cbiAgICAgICAgICAgICAgICAgICAgcm9sZTogXCJtb2RlbFwiIH0sIChfYSA9IHJlc3VsdC5yZXNwb25zZS5jYW5kaWRhdGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF0uY29udGVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5faGlzdG9yeS5wdXNoKHJlc3BvbnNlQ29udGVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBibG9ja0Vycm9yTWVzc2FnZSA9IGZvcm1hdEJsb2NrRXJyb3JNZXNzYWdlKHJlc3VsdC5yZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgaWYgKGJsb2NrRXJyb3JNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybihgc2VuZE1lc3NhZ2UoKSB3YXMgdW5zdWNjZXNzZnVsLiAke2Jsb2NrRXJyb3JNZXNzYWdlfS4gSW5zcGVjdCByZXNwb25zZSBvYmplY3QgZm9yIGRldGFpbHMuYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmluYWxSZXN1bHQgPSByZXN1bHQ7XG4gICAgICAgIH0pO1xuICAgICAgICBhd2FpdCB0aGlzLl9zZW5kUHJvbWlzZTtcbiAgICAgICAgcmV0dXJuIGZpbmFsUmVzdWx0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZW5kcyBhIGNoYXQgbWVzc2FnZSBhbmQgcmVjZWl2ZXMgdGhlIHJlc3BvbnNlIGFzIGFcbiAgICAgKiB7QGxpbmsgR2VuZXJhdGVDb250ZW50U3RyZWFtUmVzdWx0fSBjb250YWluaW5nIGFuIGl0ZXJhYmxlIHN0cmVhbVxuICAgICAqIGFuZCBhIHJlc3BvbnNlIHByb21pc2UuXG4gICAgICovXG4gICAgYXN5bmMgc2VuZE1lc3NhZ2VTdHJlYW0ocmVxdWVzdCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgICAgICBhd2FpdCB0aGlzLl9zZW5kUHJvbWlzZTtcbiAgICAgICAgY29uc3QgbmV3Q29udGVudCA9IGZvcm1hdE5ld0NvbnRlbnQocmVxdWVzdCk7XG4gICAgICAgIGNvbnN0IGdlbmVyYXRlQ29udGVudFJlcXVlc3QgPSB7XG4gICAgICAgICAgICBzYWZldHlTZXR0aW5nczogKF9hID0gdGhpcy5wYXJhbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zYWZldHlTZXR0aW5ncyxcbiAgICAgICAgICAgIGdlbmVyYXRpb25Db25maWc6IChfYiA9IHRoaXMucGFyYW1zKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZ2VuZXJhdGlvbkNvbmZpZyxcbiAgICAgICAgICAgIHRvb2xzOiAoX2MgPSB0aGlzLnBhcmFtcykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnRvb2xzLFxuICAgICAgICAgICAgdG9vbENvbmZpZzogKF9kID0gdGhpcy5wYXJhbXMpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC50b29sQ29uZmlnLFxuICAgICAgICAgICAgc3lzdGVtSW5zdHJ1Y3Rpb246IChfZSA9IHRoaXMucGFyYW1zKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Uuc3lzdGVtSW5zdHJ1Y3Rpb24sXG4gICAgICAgICAgICBjb250ZW50czogWy4uLnRoaXMuX2hpc3RvcnksIG5ld0NvbnRlbnRdLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzdHJlYW1Qcm9taXNlID0gZ2VuZXJhdGVDb250ZW50U3RyZWFtKHRoaXMuX2FwaUtleSwgdGhpcy5tb2RlbCwgZ2VuZXJhdGVDb250ZW50UmVxdWVzdCwgdGhpcy5yZXF1ZXN0T3B0aW9ucyk7XG4gICAgICAgIC8vIEFkZCBvbnRvIHRoZSBjaGFpbi5cbiAgICAgICAgdGhpcy5fc2VuZFByb21pc2UgPSB0aGlzLl9zZW5kUHJvbWlzZVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gc3RyZWFtUHJvbWlzZSlcbiAgICAgICAgICAgIC8vIFRoaXMgbXVzdCBiZSBoYW5kbGVkIHRvIGF2b2lkIHVuaGFuZGxlZCByZWplY3Rpb24sIGJ1dCBqdW1wXG4gICAgICAgICAgICAvLyB0byB0aGUgZmluYWwgY2F0Y2ggYmxvY2sgd2l0aCBhIGxhYmVsIHRvIG5vdCBsb2cgdGhpcyBlcnJvci5cbiAgICAgICAgICAgIC5jYXRjaCgoX2lnbm9yZWQpID0+IHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihTSUxFTlRfRVJST1IpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKHN0cmVhbVJlc3VsdCkgPT4gc3RyZWFtUmVzdWx0LnJlc3BvbnNlKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuY2FuZGlkYXRlcyAmJiByZXNwb25zZS5jYW5kaWRhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9oaXN0b3J5LnB1c2gobmV3Q29udGVudCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VDb250ZW50ID0gT2JqZWN0LmFzc2lnbih7fSwgcmVzcG9uc2UuY2FuZGlkYXRlc1swXS5jb250ZW50KTtcbiAgICAgICAgICAgICAgICAvLyBSZXNwb25zZSBzZWVtcyB0byBjb21lIGJhY2sgd2l0aG91dCBhIHJvbGUgc2V0LlxuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2VDb250ZW50LnJvbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VDb250ZW50LnJvbGUgPSBcIm1vZGVsXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX2hpc3RvcnkucHVzaChyZXNwb25zZUNvbnRlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYmxvY2tFcnJvck1lc3NhZ2UgPSBmb3JtYXRCbG9ja0Vycm9yTWVzc2FnZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgaWYgKGJsb2NrRXJyb3JNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybihgc2VuZE1lc3NhZ2VTdHJlYW0oKSB3YXMgdW5zdWNjZXNzZnVsLiAke2Jsb2NrRXJyb3JNZXNzYWdlfS4gSW5zcGVjdCByZXNwb25zZSBvYmplY3QgZm9yIGRldGFpbHMuYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgICAvLyBFcnJvcnMgaW4gc3RyZWFtUHJvbWlzZSBhcmUgYWxyZWFkeSBjYXRjaGFibGUgYnkgdGhlIHVzZXIgYXNcbiAgICAgICAgICAgIC8vIHN0cmVhbVByb21pc2UgaXMgcmV0dXJuZWQuXG4gICAgICAgICAgICAvLyBBdm9pZCBkdXBsaWNhdGluZyB0aGUgZXJyb3IgbWVzc2FnZSBpbiBsb2dzLlxuICAgICAgICAgICAgaWYgKGUubWVzc2FnZSAhPT0gU0lMRU5UX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlcnMgZG8gbm90IGhhdmUgYWNjZXNzIHRvIF9zZW5kUHJvbWlzZSB0byBjYXRjaCBlcnJvcnNcbiAgICAgICAgICAgICAgICAvLyBkb3duc3RyZWFtIGZyb20gc3RyZWFtUHJvbWlzZSwgc28gdGhleSBzaG91bGQgbm90IHRocm93LlxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc3RyZWFtUHJvbWlzZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDI0IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5hc3luYyBmdW5jdGlvbiBjb3VudFRva2VucyhhcGlLZXksIG1vZGVsLCBwYXJhbXMsIHJlcXVlc3RPcHRpb25zKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtYWtlUmVxdWVzdChtb2RlbCwgVGFzay5DT1VOVF9UT0tFTlMsIGFwaUtleSwgZmFsc2UsIEpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcGFyYW1zKSwgeyBtb2RlbCB9KSksIHJlcXVlc3RPcHRpb25zKTtcbiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyNCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZW1iZWRDb250ZW50KGFwaUtleSwgbW9kZWwsIHBhcmFtcywgcmVxdWVzdE9wdGlvbnMpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG1ha2VSZXF1ZXN0KG1vZGVsLCBUYXNrLkVNQkVEX0NPTlRFTlQsIGFwaUtleSwgZmFsc2UsIEpTT04uc3RyaW5naWZ5KHBhcmFtcyksIHJlcXVlc3RPcHRpb25zKTtcbiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xufVxuYXN5bmMgZnVuY3Rpb24gYmF0Y2hFbWJlZENvbnRlbnRzKGFwaUtleSwgbW9kZWwsIHBhcmFtcywgcmVxdWVzdE9wdGlvbnMpIHtcbiAgICBjb25zdCByZXF1ZXN0c1dpdGhNb2RlbCA9IHBhcmFtcy5yZXF1ZXN0cy5tYXAoKHJlcXVlc3QpID0+IHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcmVxdWVzdCksIHsgbW9kZWwgfSk7XG4gICAgfSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtYWtlUmVxdWVzdChtb2RlbCwgVGFzay5CQVRDSF9FTUJFRF9DT05URU5UUywgYXBpS2V5LCBmYWxzZSwgSlNPTi5zdHJpbmdpZnkoeyByZXF1ZXN0czogcmVxdWVzdHNXaXRoTW9kZWwgfSksIHJlcXVlc3RPcHRpb25zKTtcbiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyNCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDbGFzcyBmb3IgZ2VuZXJhdGl2ZSBtb2RlbCBBUElzLlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBHZW5lcmF0aXZlTW9kZWwge1xuICAgIGNvbnN0cnVjdG9yKGFwaUtleSwgbW9kZWxQYXJhbXMsIHJlcXVlc3RPcHRpb25zKSB7XG4gICAgICAgIHRoaXMuYXBpS2V5ID0gYXBpS2V5O1xuICAgICAgICBpZiAobW9kZWxQYXJhbXMubW9kZWwuaW5jbHVkZXMoXCIvXCIpKSB7XG4gICAgICAgICAgICAvLyBNb2RlbHMgbWF5IGJlIG5hbWVkIFwibW9kZWxzL21vZGVsLW5hbWVcIiBvciBcInR1bmVkTW9kZWxzL21vZGVsLW5hbWVcIlxuICAgICAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsUGFyYW1zLm1vZGVsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgcGF0aCBpcyBub3QgaW5jbHVkZWQsIGFzc3VtZSBpdCdzIGEgbm9uLXR1bmVkIG1vZGVsLlxuICAgICAgICAgICAgdGhpcy5tb2RlbCA9IGBtb2RlbHMvJHttb2RlbFBhcmFtcy5tb2RlbH1gO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ2VuZXJhdGlvbkNvbmZpZyA9IG1vZGVsUGFyYW1zLmdlbmVyYXRpb25Db25maWcgfHwge307XG4gICAgICAgIHRoaXMuc2FmZXR5U2V0dGluZ3MgPSBtb2RlbFBhcmFtcy5zYWZldHlTZXR0aW5ncyB8fCBbXTtcbiAgICAgICAgdGhpcy50b29scyA9IG1vZGVsUGFyYW1zLnRvb2xzO1xuICAgICAgICB0aGlzLnRvb2xDb25maWcgPSBtb2RlbFBhcmFtcy50b29sQ29uZmlnO1xuICAgICAgICB0aGlzLnN5c3RlbUluc3RydWN0aW9uID0gZm9ybWF0U3lzdGVtSW5zdHJ1Y3Rpb24obW9kZWxQYXJhbXMuc3lzdGVtSW5zdHJ1Y3Rpb24pO1xuICAgICAgICB0aGlzLnJlcXVlc3RPcHRpb25zID0gcmVxdWVzdE9wdGlvbnMgfHwge307XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1ha2VzIGEgc2luZ2xlIG5vbi1zdHJlYW1pbmcgY2FsbCB0byB0aGUgbW9kZWxcbiAgICAgKiBhbmQgcmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyBhIHNpbmdsZSB7QGxpbmsgR2VuZXJhdGVDb250ZW50UmVzcG9uc2V9LlxuICAgICAqL1xuICAgIGFzeW5jIGdlbmVyYXRlQ29udGVudChyZXF1ZXN0KSB7XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZFBhcmFtcyA9IGZvcm1hdEdlbmVyYXRlQ29udGVudElucHV0KHJlcXVlc3QpO1xuICAgICAgICByZXR1cm4gZ2VuZXJhdGVDb250ZW50KHRoaXMuYXBpS2V5LCB0aGlzLm1vZGVsLCBPYmplY3QuYXNzaWduKHsgZ2VuZXJhdGlvbkNvbmZpZzogdGhpcy5nZW5lcmF0aW9uQ29uZmlnLCBzYWZldHlTZXR0aW5nczogdGhpcy5zYWZldHlTZXR0aW5ncywgdG9vbHM6IHRoaXMudG9vbHMsIHRvb2xDb25maWc6IHRoaXMudG9vbENvbmZpZywgc3lzdGVtSW5zdHJ1Y3Rpb246IHRoaXMuc3lzdGVtSW5zdHJ1Y3Rpb24gfSwgZm9ybWF0dGVkUGFyYW1zKSwgdGhpcy5yZXF1ZXN0T3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1ha2VzIGEgc2luZ2xlIHN0cmVhbWluZyBjYWxsIHRvIHRoZSBtb2RlbFxuICAgICAqIGFuZCByZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIGFuIGl0ZXJhYmxlIHN0cmVhbSB0aGF0IGl0ZXJhdGVzXG4gICAgICogb3ZlciBhbGwgY2h1bmtzIGluIHRoZSBzdHJlYW1pbmcgcmVzcG9uc2UgYXMgd2VsbCBhc1xuICAgICAqIGEgcHJvbWlzZSB0aGF0IHJldHVybnMgdGhlIGZpbmFsIGFnZ3JlZ2F0ZWQgcmVzcG9uc2UuXG4gICAgICovXG4gICAgYXN5bmMgZ2VuZXJhdGVDb250ZW50U3RyZWFtKHJlcXVlc3QpIHtcbiAgICAgICAgY29uc3QgZm9ybWF0dGVkUGFyYW1zID0gZm9ybWF0R2VuZXJhdGVDb250ZW50SW5wdXQocmVxdWVzdCk7XG4gICAgICAgIHJldHVybiBnZW5lcmF0ZUNvbnRlbnRTdHJlYW0odGhpcy5hcGlLZXksIHRoaXMubW9kZWwsIE9iamVjdC5hc3NpZ24oeyBnZW5lcmF0aW9uQ29uZmlnOiB0aGlzLmdlbmVyYXRpb25Db25maWcsIHNhZmV0eVNldHRpbmdzOiB0aGlzLnNhZmV0eVNldHRpbmdzLCB0b29sczogdGhpcy50b29scywgdG9vbENvbmZpZzogdGhpcy50b29sQ29uZmlnLCBzeXN0ZW1JbnN0cnVjdGlvbjogdGhpcy5zeXN0ZW1JbnN0cnVjdGlvbiB9LCBmb3JtYXR0ZWRQYXJhbXMpLCB0aGlzLnJlcXVlc3RPcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyBhIG5ldyB7QGxpbmsgQ2hhdFNlc3Npb259IGluc3RhbmNlIHdoaWNoIGNhbiBiZSB1c2VkIGZvclxuICAgICAqIG11bHRpLXR1cm4gY2hhdHMuXG4gICAgICovXG4gICAgc3RhcnRDaGF0KHN0YXJ0Q2hhdFBhcmFtcykge1xuICAgICAgICByZXR1cm4gbmV3IENoYXRTZXNzaW9uKHRoaXMuYXBpS2V5LCB0aGlzLm1vZGVsLCBPYmplY3QuYXNzaWduKHsgZ2VuZXJhdGlvbkNvbmZpZzogdGhpcy5nZW5lcmF0aW9uQ29uZmlnLCBzYWZldHlTZXR0aW5nczogdGhpcy5zYWZldHlTZXR0aW5ncywgdG9vbHM6IHRoaXMudG9vbHMsIHRvb2xDb25maWc6IHRoaXMudG9vbENvbmZpZywgc3lzdGVtSW5zdHJ1Y3Rpb246IHRoaXMuc3lzdGVtSW5zdHJ1Y3Rpb24gfSwgc3RhcnRDaGF0UGFyYW1zKSwgdGhpcy5yZXF1ZXN0T3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvdW50cyB0aGUgdG9rZW5zIGluIHRoZSBwcm92aWRlZCByZXF1ZXN0LlxuICAgICAqL1xuICAgIGFzeW5jIGNvdW50VG9rZW5zKHJlcXVlc3QpIHtcbiAgICAgICAgY29uc3QgZm9ybWF0dGVkUGFyYW1zID0gZm9ybWF0R2VuZXJhdGVDb250ZW50SW5wdXQocmVxdWVzdCk7XG4gICAgICAgIHJldHVybiBjb3VudFRva2Vucyh0aGlzLmFwaUtleSwgdGhpcy5tb2RlbCwgZm9ybWF0dGVkUGFyYW1zLCB0aGlzLnJlcXVlc3RPcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW1iZWRzIHRoZSBwcm92aWRlZCBjb250ZW50LlxuICAgICAqL1xuICAgIGFzeW5jIGVtYmVkQ29udGVudChyZXF1ZXN0KSB7XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZFBhcmFtcyA9IGZvcm1hdEVtYmVkQ29udGVudElucHV0KHJlcXVlc3QpO1xuICAgICAgICByZXR1cm4gZW1iZWRDb250ZW50KHRoaXMuYXBpS2V5LCB0aGlzLm1vZGVsLCBmb3JtYXR0ZWRQYXJhbXMsIHRoaXMucmVxdWVzdE9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbWJlZHMgYW4gYXJyYXkgb2Yge0BsaW5rIEVtYmVkQ29udGVudFJlcXVlc3R9cy5cbiAgICAgKi9cbiAgICBhc3luYyBiYXRjaEVtYmVkQ29udGVudHMoYmF0Y2hFbWJlZENvbnRlbnRSZXF1ZXN0KSB7XG4gICAgICAgIHJldHVybiBiYXRjaEVtYmVkQ29udGVudHModGhpcy5hcGlLZXksIHRoaXMubW9kZWwsIGJhdGNoRW1iZWRDb250ZW50UmVxdWVzdCwgdGhpcy5yZXF1ZXN0T3B0aW9ucyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyNCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUb3AtbGV2ZWwgY2xhc3MgZm9yIHRoaXMgU0RLXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEdvb2dsZUdlbmVyYXRpdmVBSSB7XG4gICAgY29uc3RydWN0b3IoYXBpS2V5KSB7XG4gICAgICAgIHRoaXMuYXBpS2V5ID0gYXBpS2V5O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIGEge0BsaW5rIEdlbmVyYXRpdmVNb2RlbH0gaW5zdGFuY2UgZm9yIHRoZSBwcm92aWRlZCBtb2RlbCBuYW1lLlxuICAgICAqL1xuICAgIGdldEdlbmVyYXRpdmVNb2RlbChtb2RlbFBhcmFtcywgcmVxdWVzdE9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCFtb2RlbFBhcmFtcy5tb2RlbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEdvb2dsZUdlbmVyYXRpdmVBSUVycm9yKGBNdXN0IHByb3ZpZGUgYSBtb2RlbCBuYW1lLiBgICtcbiAgICAgICAgICAgICAgICBgRXhhbXBsZTogZ2VuYWkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHsgbW9kZWw6ICdteS1tb2RlbC1uYW1lJyB9KWApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgR2VuZXJhdGl2ZU1vZGVsKHRoaXMuYXBpS2V5LCBtb2RlbFBhcmFtcywgcmVxdWVzdE9wdGlvbnMpO1xuICAgIH1cbn1cblxuZXhwb3J0cy5DaGF0U2Vzc2lvbiA9IENoYXRTZXNzaW9uO1xuZXhwb3J0cy5HZW5lcmF0aXZlTW9kZWwgPSBHZW5lcmF0aXZlTW9kZWw7XG5leHBvcnRzLkdvb2dsZUdlbmVyYXRpdmVBSSA9IEdvb2dsZUdlbmVyYXRpdmVBSTtcbmV4cG9ydHMuR29vZ2xlR2VuZXJhdGl2ZUFJRXJyb3IgPSBHb29nbGVHZW5lcmF0aXZlQUlFcnJvcjtcbmV4cG9ydHMuR29vZ2xlR2VuZXJhdGl2ZUFJRmV0Y2hFcnJvciA9IEdvb2dsZUdlbmVyYXRpdmVBSUZldGNoRXJyb3I7XG5leHBvcnRzLkdvb2dsZUdlbmVyYXRpdmVBSVJlcXVlc3RJbnB1dEVycm9yID0gR29vZ2xlR2VuZXJhdGl2ZUFJUmVxdWVzdElucHV0RXJyb3I7XG5leHBvcnRzLkdvb2dsZUdlbmVyYXRpdmVBSVJlc3BvbnNlRXJyb3IgPSBHb29nbGVHZW5lcmF0aXZlQUlSZXNwb25zZUVycm9yO1xuZXhwb3J0cy5QT1NTSUJMRV9ST0xFUyA9IFBPU1NJQkxFX1JPTEVTO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwXG4iLCAiaW1wb3J0IHsgQXBwLCBFZGl0b3IsIE1hcmtkb3duVmlldywgTW9kYWwsIE5vdGljZSwgUGx1Z2luLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5cclxuLy8gQ2FycmVnYSBhIGNsYXNzZSBkbyBHb29nbGUgR2VuZXJhdGl2ZSBBSVxyXG5jb25zdCB7IEdvb2dsZUdlbmVyYXRpdmVBSSB9ID0gcmVxdWlyZShcIkBnb29nbGUvZ2VuZXJhdGl2ZS1haVwiKTtcclxuXHJcbi8vIERlZmluZSBhcyB2YXJpXHUwMEUxdmVpcyBkZSBjb25maWd1cmFcdTAwRTdcdTAwRTNvIGRvIHBsdWdpblxyXG5pbnRlcmZhY2UgR2VtaW5pUGx1Z2luU2V0dGluZ3Mge1xyXG5cdEFQSUtleTogc3RyaW5nO1xyXG4gICAgcHJvbXB0U3VtbWFyeTogc3RyaW5nO1xyXG4gICAgcHJvbXB0RXhwYW5kOiBzdHJpbmc7XHJcbiAgICBwcm9tcHRSZXdyaXRlOiBzdHJpbmc7XHJcbiAgICBwcm9tcHRBbnN3ZXI6IHN0cmluZztcclxufVxyXG5cclxuLy8gRGVmaW5lIGFzIGNvbmZpZ3VyYVx1MDBFN1x1MDBGNWVzIHBhZHJcdTAwRTNvIGRvIHBsdWdpblxyXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBHZW1pbmlQbHVnaW5TZXR0aW5ncyA9IHtcclxuXHRBUElLZXk6ICcnLFxyXG4gICAgcHJvbXB0U3VtbWFyeTogJ1Jlc3VtYSBvIHRleHRvIGEgc2VndWlyOiAnLFxyXG4gICAgcHJvbXB0RXhwYW5kOiAnRXhwYW5kYSBvIHRleHRvIGEgc2VndWlyOiAnLFxyXG4gICAgcHJvbXB0UmV3cml0ZTogJ1JlZXNjcmV2YSBvIHRleHRvIGEgc2VndWlyOiAnLFxyXG4gICAgcHJvbXB0QW5zd2VyOiAnUmVzcG9uZGEgYSBwZXJndW50YSBhIHNlZ3VpcjonXHJcblxyXG59XHJcblxyXG4vLyBEZWZpbmUgYSBjbGFzc2UgZG8gcGx1Z2luIGUgc3VhcyBmdW5cdTAwRTdcdTAwRjVlc1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHZW1pbmlQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG4gICAgc2V0dGluZ3M6IEdlbWluaVBsdWdpblNldHRpbmdzOyAvLyBDb25maWd1cmFcdTAwRTdcdTAwRjVlcyBkbyBwbHVnaW5cclxuICAgIGdlbkFJOiBHb29nbGVHZW5lcmF0aXZlQUk7IC8vIEluc3RcdTAwRTJuY2lhIGRvIEdvb2dsZSBHZW5lcmF0aXZlIEFJXHJcblxyXG4gICAgLy8gRnVuXHUwMEU3XHUwMEUzbyBkZSBpbmljaWFsaXphXHUwMEU3XHUwMEUzbyBkbyBwbHVnaW5cclxuICAgIGFzeW5jIG9ubG9hZCgpIHtcclxuICAgICAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpOyAvLyBDYXJyZWdhIGFzIGNvbmZpZ3VyYVx1MDBFN1x1MDBGNWVzIGRvIHBsdWdpblxyXG5cclxuICAgICAgICB0aGlzLmdlbkFJID0gbmV3IEdvb2dsZUdlbmVyYXRpdmVBSSh0aGlzLnNldHRpbmdzLkFQSUtleSk7IC8vIEluaWNpYWxpemEgbyBHb29nbGUgR2VuZXJhdGl2ZSBBSVxyXG5cclxuICAgICAgICAvLyBBZGljaW9uYSBvIGNvbWFuZG8gZGUgcmVzdW1vIGRlIHRleHRvIG5vIE9ic2lkaWFuXHJcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcclxuICAgICAgICAgICAgaWQ6ICdxdWljay1zdW1tYXJ5JyxcclxuICAgICAgICAgICAgbmFtZTogJ1Jlc3VtaXIgdGV4dG8nLFxyXG4gICAgICAgICAgICBlZGl0b3JDYWxsYmFjazogYXN5bmMgKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGVkaXRvci5nZXRTZWxlY3Rpb24oKTsgLy8gUGVnYSBvIHRleHRvIHNlbGVjaW9uYWRvIG5vIGVkaXRvclxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEFicmUgbyBtb2RhbCBkZSBjYXJyZWdhbWVudG9cclxuICAgICAgICAgICAgICAgIGNvbnN0IGxvYWRpbmdNb2RhbCA9IG5ldyBMb2FkaW5nTW9kYWwodGhpcy5hcHApOyAvLyBDcmlhIG8gbW9kYWwgZGUgY2FycmVnYW1lbnRvXHJcbiAgICAgICAgICAgICAgICBsb2FkaW5nTW9kYWwub3BlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEdlcmEgbyByZXN1bW8gZG8gdGV4dG8gc2VsZWNpb25hZG9cclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvbXB0ID0gdGhpcy5zZXR0aW5ncy5wcm9tcHRTdW1tYXJ5ICsgc2VsZWN0aW9uOyAvLyBEZWZpbmUgbyBwcm9tcHQgZGUgcmVzdW1vXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcnVuKHByb21wdCwgdGhpcy5nZW5BSSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEluc2VyZSBvIHJlc3VtbyBubyBlZGl0b3IgZGUgdGV4dG8gYWJhaXhvIGRvIHRleHRvIHNlbGVjaW9uYWRvXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlUmFuZ2UoXCJcXG5cXG5cIiArIHJlc3VsdCwgeyBsaW5lOiBjdXJzb3IubGluZSArIDEsIGNoOiAwIH0sIHsgbGluZTogY3Vyc29yLmxpbmUgKyAxLCBjaDogMCB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTW92ZSBvIGN1cnNvciBwYXJhIG8gZmluYWwgZG8gcmVzdW1vXHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNldEN1cnNvcih7IGxpbmU6IGN1cnNvci5saW5lICsgMiwgY2g6IDAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEV4aWJlIHVtYSBtZW5zYWdlbSBkZSBlcnJvIGNhc28gb2NvcnJhIGFsZ3VtIHByb2JsZW1hXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkVycm8gYW8gZ2VyYXIgY29udGVcdTAwRkFkbzogXCIgKyBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH0gZmluYWxseSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRmVjaGEgbyBtb2RhbCBkZSBjYXJyZWdhbWVudG9cclxuICAgICAgICAgICAgICAgICAgICBsb2FkaW5nTW9kYWwuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBBZGljaW9uYSBvIGNvbWFuZG8gZGUgZXhwYW5zXHUwMEUzbyBkZSB0ZXh0byBubyBPYnNpZGlhblxyXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XHJcbiAgICAgICAgICAgIGlkOiAncXVpY2stZXhwYW5kJyxcclxuICAgICAgICAgICAgbmFtZTogJ0V4cGFuZGlyIHRleHRvJyxcclxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IGFzeW5jIChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7IC8vIFBlZ2EgbyB0ZXh0byBzZWxlY2lvbmFkbyBubyBlZGl0b3JcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBBYnJlIG8gbW9kYWwgZGUgY2FycmVnYW1lbnRvXHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nTW9kYWwgPSBuZXcgTG9hZGluZ01vZGFsKHRoaXMuYXBwKTsgLy8gQ3JpYSBvIG1vZGFsIGRlIGNhcnJlZ2FtZW50b1xyXG4gICAgICAgICAgICAgICAgbG9hZGluZ01vZGFsLm9wZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBHZXJhIGEgZXhwYW5zXHUwMEUzbyBkbyB0ZXh0byBzZWxlY2lvbmFkb1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9tcHQgPSB0aGlzLnNldHRpbmdzLnByb21wdEV4cGFuZCArIHNlbGVjdGlvbjsgLy8gRGVmaW5lIG8gcHJvbXB0IGRlIGV4cGFuc1x1MDBFM29cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBydW4ocHJvbXB0LCB0aGlzLmdlbkFJKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSW5zZXJlIGEgZXhwYW5zXHUwMEUzbyBubyBlZGl0b3IgZGUgdGV4dG8gYWJhaXhvIGRvIHRleHRvIHNlbGVjaW9uYWRvXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlUmFuZ2UoXCJcXG5cXG5cIiArIHJlc3VsdCwgeyBsaW5lOiBjdXJzb3IubGluZSArIDEsIGNoOiAwIH0sIHsgbGluZTogY3Vyc29yLmxpbmUgKyAxLCBjaDogMCB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTW92ZSBvIGN1cnNvciBwYXJhIG8gZmluYWwgZGEgZXhwYW5zXHUwMEUzb1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5zZXRDdXJzb3IoeyBsaW5lOiBjdXJzb3IubGluZSArIDIsIGNoOiAwIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBFeGliZSB1bWEgbWVuc2FnZW0gZGUgZXJybyBjYXNvIG9jb3JyYSBhbGd1bSBwcm9ibGVtYVxyXG4gICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJFcnJvIGFvIGdlcmFyIGNvbnRlXHUwMEZBZG86IFwiICsgZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEZlY2hhIG8gbW9kYWwgZGUgY2FycmVnYW1lbnRvXHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ01vZGFsLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gQWRpY2lvbmEgbyBjb21hbmRvIGRlIHJlZXNjcml0YSBkZSB0ZXh0byBubyBPYnNpZGlhblxyXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XHJcbiAgICAgICAgICAgIGlkOiAncXVpY2stcmV3cml0ZScsXHJcbiAgICAgICAgICAgIG5hbWU6ICdSZWVzY3JldmVyIHRleHRvJyxcclxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IGFzeW5jIChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7IC8vIFBlZ2EgbyB0ZXh0byBzZWxlY2lvbmFkbyBubyBlZGl0b3JcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBBYnJlIG8gbW9kYWwgZGUgY2FycmVnYW1lbnRvXHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nTW9kYWwgPSBuZXcgTG9hZGluZ01vZGFsKHRoaXMuYXBwKTsgLy8gQ3JpYSBvIG1vZGFsIGRlIGNhcnJlZ2FtZW50b1xyXG4gICAgICAgICAgICAgICAgbG9hZGluZ01vZGFsLm9wZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBHZXJhIGEgcmVlc2NyaXRhIGRvIHRleHRvIHNlbGVjaW9uYWRvXHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb21wdCA9IHRoaXMuc2V0dGluZ3MucHJvbXB0UmV3cml0ZSArIHNlbGVjdGlvbjsgLy8gRGVmaW5lIG8gcHJvbXB0IGRlIHJlZXNjcml0YVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJ1bihwcm9tcHQsIHRoaXMuZ2VuQUkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBJbnNlcmUgYSByZWVzY3JpdGEgbm8gZWRpdG9yIGRlIHRleHRvIGFiYWl4byBkbyB0ZXh0byBzZWxlY2lvbmFkb1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnNvciA9IGVkaXRvci5nZXRDdXJzb3IoKTtcclxuICAgICAgICAgICAgICAgICAgICBlZGl0b3IucmVwbGFjZVJhbmdlKFwiXFxuXFxuXCIgKyByZXN1bHQsIHsgbGluZTogY3Vyc29yLmxpbmUgKyAxLCBjaDogMCB9LCB7IGxpbmU6IGN1cnNvci5saW5lICsgMSwgY2g6IDAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgbyBjdXJzb3IgcGFyYSBvIGZpbmFsIGRhIHJlZXNjcml0YVxyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5zZXRDdXJzb3IoeyBsaW5lOiBjdXJzb3IubGluZSArIDIsIGNoOiAwIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBFeGliZSB1bWEgbWVuc2FnZW0gZGUgZXJybyBjYXNvIG9jb3JyYSBhbGd1bSBwcm9ibGVtYVxyXG4gICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJFcnJvIGFvIGdlcmFyIGNvbnRlXHUwMEZBZG86IFwiICsgZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEZlY2hhIG8gbW9kYWwgZGUgY2FycmVnYW1lbnRvXHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ01vZGFsLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gQWRpY2lvbmEgbyBjb21hbmRvIGRlIHJlc3Bvc3RhIGRlIHRleHRvIG5vIE9ic2lkaWFuXHJcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcclxuICAgICAgICAgICAgaWQ6ICdxdWljay1hbnN3ZXInLFxyXG4gICAgICAgICAgICBuYW1lOiAnUmVzcG9uZGVyIHRleHRvJyxcclxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IGFzeW5jIChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7IC8vIFBlZ2EgbyB0ZXh0byBzZWxlY2lvbmFkbyBubyBlZGl0b3JcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBBYnJlIG8gbW9kYWwgZGUgY2FycmVnYW1lbnRvXHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nTW9kYWwgPSBuZXcgTG9hZGluZ01vZGFsKHRoaXMuYXBwKTsgLy8gQ3JpYSBvIG1vZGFsIGRlIGNhcnJlZ2FtZW50b1xyXG4gICAgICAgICAgICAgICAgbG9hZGluZ01vZGFsLm9wZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBHZXJhIGEgcmVzcG9zdGEgZG8gdGV4dG8gc2VsZWNpb25hZG9cclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvbXB0ID0gdGhpcy5zZXR0aW5ncy5wcm9tcHRBbnN3ZXIgKyBzZWxlY3Rpb247IC8vIERlZmluZSBvIHByb21wdCBkZSByZXNwb3N0YVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJ1bihwcm9tcHQsIHRoaXMuZ2VuQUkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBJbnNlcmUgYSByZXNwb3N0YSBubyBlZGl0b3IgZGUgdGV4dG8gYWJhaXhvIGRvIHRleHRvIHNlbGVjaW9uYWRvXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlUmFuZ2UoXCJcXG5cXG5cIiArIHJlc3VsdCwgeyBsaW5lOiBjdXJzb3IubGluZSArIDEsIGNoOiAwIH0sIHsgbGluZTogY3Vyc29yLmxpbmUgKyAxLCBjaDogMCB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTW92ZSBvIGN1cnNvciBwYXJhIG8gZmluYWwgZGEgcmVzcG9zdGFcclxuICAgICAgICAgICAgICAgICAgICBlZGl0b3Iuc2V0Q3Vyc29yKHsgbGluZTogY3Vyc29yLmxpbmUgKyAyLCBjaDogMCB9KTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRXhpYmUgdW1hIG1lbnNhZ2VtIGRlIGVycm8gY2FzbyBvY29ycmEgYWxndW0gcHJvYmxlbWFcclxuICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiRXJybyBhbyBnZXJhciBjb250ZVx1MDBGQWRvOiBcIiArIGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSBmaW5hbGx5IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBGZWNoYSBvIG1vZGFsIGRlIGNhcnJlZ2FtZW50b1xyXG4gICAgICAgICAgICAgICAgICAgIGxvYWRpbmdNb2RhbC5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIEFkZCBzZXR0aW5ncyB0YWJcclxuICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IFNhbXBsZVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcclxuICAgIH1cclxuXHJcbiAgICBvbnVubG9hZCgpIHt9XHJcblxyXG4gICAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcclxuICAgICAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBTYW1wbGVTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XHJcblx0cGx1Z2luOiBHZW1pbmlQbHVnaW47XHJcblxyXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IEdlbWluaVBsdWdpbikge1xyXG5cdFx0c3VwZXIoYXBwLCBwbHVnaW4pO1xyXG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcblx0fVxyXG5cclxuXHRkaXNwbGF5KCk6IHZvaWQge1xyXG5cdFx0Y29uc3Qge2NvbnRhaW5lckVsfSA9IHRoaXM7XHJcblxyXG5cdFx0Y29udGFpbmVyRWwuZW1wdHkoKTtcclxuXHJcblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuXHRcdFx0LnNldE5hbWUoJ0FQSSBLZXknKVxyXG5cdFx0XHQuc2V0RGVzYygnUGVndWUgYSBzdWEgY2hhdmUgZGUgYWNlc3NvIG5vIHNpdGUgZG8gR2VtaW5pIEFJIChodHRwczovL21ha2Vyc3VpdGUuZ29vZ2xlLmNvbS9hcHAvYXBpa2V5P2hsPXB0LWJyKS4nKVxyXG5cdFx0XHQuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuXHRcdFx0XHQuc2V0UGxhY2Vob2xkZXIoJ1N1YSBBUEkgS0VZJylcclxuXHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuQVBJS2V5KVxyXG5cdFx0XHRcdC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuXHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLkFQSUtleSA9IHZhbHVlO1xyXG5cdFx0XHRcdFx0Ly8gU2F2ZSB0aGUgc2V0dGluZ3NcclxuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0XHRcdH0pKTtcclxuXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgLnNldE5hbWUoJ1Byb21wdCBwYXJhIHJlc3Vtb3MnKVxyXG4gICAgICAgIC5zZXREZXNjKCdEZWZpbmEgcXVhbCBiYXNlIGRlIHByb21wdCBzZXJcdTAwRTEgdXRpbGl6YWRhIHBhcmEgcmVzdW1vcy4gRXhlbXBsbzogXCJSZXN1bWEgbyB0ZXh0byBhIHNlZ3VpclwiJylcclxuICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdSZXN1bW8gbyB0ZXh0byBhIHNlZ3VpcjogJylcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnByb21wdFN1bW1hcnkpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByb21wdFN1bW1hcnkgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIC8vIFNhdmUgdGhlIHNldHRpbmdzXHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAuc2V0TmFtZSgnUHJvbXB0IHBhcmEgZXhwYW5kaXInKVxyXG4gICAgICAgIC5zZXREZXNjKCdEZWZpbmEgcXVhbCBiYXNlIGRlIHByb21wdCBzZXJcdTAwRTEgdXRpbGl6YWRhIHBhcmEgZXhwYW5kaXIuIEV4ZW1wbG86IFwiRXhwYW5kYSBvIHRleHRvIGEgc2VndWlyOlwiJylcclxuICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdFeHBhbmRhIG8gdGV4dG8gYSBzZWd1aXI6ICcpXHJcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9tcHRFeHBhbmQpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByb21wdEV4cGFuZCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgLy8gU2F2ZSB0aGUgc2V0dGluZ3NcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgIC5zZXROYW1lKCdQcm9tcHQgcGFyYSByZWVzY3JldmVyJylcclxuICAgICAgICAuc2V0RGVzYygnRGVmaW5hIHF1YWwgYmFzZSBkZSBwcm9tcHQgc2VyXHUwMEUxIHV0aWxpemFkYSBwYXJhIHJlZXNjcmV2ZXIuIEV4ZW1wbG86IFwiUmVlc2NyZXZhIG8gdGV4dG8gYSBzZWd1aXI6XCInKVxyXG4gICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxyXG4gICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ1JlZXNjcmV2YSBvIHRleHRvIGEgc2VndWlyOiAnKVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvbXB0UmV3cml0ZSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvbXB0UmV3cml0ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgLy8gU2F2ZSB0aGUgc2V0dGluZ3NcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgIC5zZXROYW1lKCdQcm9tcHQgcGFyYSByZXNwb25kZXInKVxyXG4gICAgICAgIC5zZXREZXNjKCdEZWZpbmEgcXVhbCBiYXNlIGRlIHByb21wdCBzZXJcdTAwRTEgdXRpbGl6YWRhIHBhcmEgcmVzcG9uZGVyLiBFeGVtcGxvOiBcIlJlc3BvbmRhIGEgcGVyZ3VudGEgYSBzZWd1aXI6XCInKVxyXG4gICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxyXG4gICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ1Jlc3BvbmRhIGEgcGVyZ3VudGEgYSBzZWd1aXI6ICcpXHJcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9tcHRBbnN3ZXIpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByb21wdEFuc3dlciA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgLy8gU2F2ZSB0aGUgc2V0dGluZ3NcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KSk7XHJcblx0fVxyXG59XHJcblxyXG4vLyBEZWZpbmUgbyBtb2RlbG8gcXVlIHNlclx1MDBFMSB1dGlsaXphZG8gbm8gR29vZ2xlIEdlbmVyYXRpdmUgQUkgZSBleGVjdXRhIGEgZnVuXHUwMEU3XHUwMEUzbyBkZSBnZXJhXHUwMEU3XHUwMEUzbyBkZSBjb250ZVx1MDBGQWRvXHJcbmFzeW5jIGZ1bmN0aW9uIHJ1bihwcm9tcHQ6IHN0cmluZywgZ2VuQUk6IEdvb2dsZUdlbmVyYXRpdmVBSSkge1xyXG4gICAgLy8gRm9yIHRleHQtb25seSBpbnB1dCwgdXNlIHRoZSBnZW1pbmktcHJvIG1vZGVsXHJcbiAgICBjb25zdCBtb2RlbCA9IGdlbkFJLmdldEdlbmVyYXRpdmVNb2RlbCh7IG1vZGVsOiBcImdlbWluaS1wcm9cIn0pO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbW9kZWwuZ2VuZXJhdGVDb250ZW50KHByb21wdCk7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlc3VsdC5yZXNwb25zZTtcclxuICAgIGNvbnN0IHRleHQgPSByZXNwb25zZS50ZXh0KCk7XHJcbiAgICByZXR1cm4gdGV4dDtcclxufVxyXG5cclxuLy8gTW9kYWwgZGUgY2FycmVnYW1lbnRvXHJcbmNsYXNzIExvYWRpbmdNb2RhbCBleHRlbmRzIE1vZGFsIHtcclxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwKTtcclxuICAgIH1cclxuXHJcbiAgICBvbk9wZW4oKSB7XHJcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICAgICAgY29udGVudEVsLmNyZWF0ZUVsKCdkaXYnLCB7IHRleHQ6ICdHZW5lcmF0aW5nIGNvbnRlbnQuLi4nLCBjbHM6ICdsb2FkaW5nLW1lc3NhZ2UnIH0pO1xyXG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnZGl2JywgeyBjbHM6ICdsb2FkaW5nLWFuaW1hdGlvbicgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbG9zZSgpIHtcclxuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcclxuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcclxuICAgIH1cclxufSJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQXNCQSxRQUFNLGlCQUFpQixDQUFDLFFBQVEsU0FBUyxZQUFZLFFBQVE7QUFLN0QsWUFBUSxlQUFlO0FBQ3ZCLEtBQUMsU0FBVSxjQUFjO0FBQ3JCLG1CQUFhLDJCQUEyQixJQUFJO0FBQzVDLG1CQUFhLDJCQUEyQixJQUFJO0FBQzVDLG1CQUFhLGlDQUFpQyxJQUFJO0FBQ2xELG1CQUFhLDBCQUEwQixJQUFJO0FBQzNDLG1CQUFhLGlDQUFpQyxJQUFJO0FBQUEsSUFDdEQsR0FBRyxRQUFRLGlCQUFpQixRQUFRLGVBQWUsQ0FBQyxFQUFFO0FBS3RELFlBQVEscUJBQXFCO0FBQzdCLEtBQUMsU0FBVSxvQkFBb0I7QUFFM0IseUJBQW1CLGtDQUFrQyxJQUFJO0FBRXpELHlCQUFtQixxQkFBcUIsSUFBSTtBQUU1Qyx5QkFBbUIsd0JBQXdCLElBQUk7QUFFL0MseUJBQW1CLGlCQUFpQixJQUFJO0FBRXhDLHlCQUFtQixZQUFZLElBQUk7QUFBQSxJQUN2QyxHQUFHLFFBQVEsdUJBQXVCLFFBQVEscUJBQXFCLENBQUMsRUFBRTtB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
